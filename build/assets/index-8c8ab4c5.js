import{g as We,a as Ue,s as de,_ as W,a9 as to,r as b,b as Ye,j as n,d as Ge,c as le,e as He,u as _t,aM as oo,b5 as Ne,b6 as Ze,a7 as lt,b7 as no,b8 as so,a0 as ro,f as F,F as j,h as D,D as Me,a$ as io,T as q,B as Nt,N as ke,aZ as he,b0 as $t,b9 as ao,ba as co,bb as lo,Z as N,bc as pe,bd as fe,ap as dt,be as Te,bf as Se,bg as ut,bh as J,bi as uo,ar as po,bj as pt,bk as ft,bl as ht,bm as mt,bn as fo,am as ho,W as mo,bo as go,bp as bo,bq as xo,aR as gt}from"./index-d939ea8c.js";import{B as yo}from"./index-7bef8ad5.js";import{p as wo,q as jo,i as vo,C as we,I as Eo,B as ve,c as Ke,b as It,F as zt,r as Po}from"./react-toastify.esm-cf8782e0.js";import{e as Co,A as Ae}from"./index-31f9e032.js";import{T as _e}from"./index-6fe2dc08.js";import{c as bt,d as To,a as So}from"./index-e560e4ff.js";import{D as Oo,P as Mo}from"./PlusIcon-46d7f62d.js";import{p as ko,c as Ao,g as _o,t as Le}from"./index-763239f7.js";import{u as No}from"./Popover-144bfca7.js";import{u as $o}from"./index-e0c3cdc4.js";import{L as Io,m as zo,u as te,b as $e,T as Rt,H as Ro,C as Bo}from"./constant-90225514.js";import{f as Do,P as Fo,L as Vo}from"./constants-20f18c00.js";import{A as xt}from"./AddContentIcon-cac3b793.js";import"./useSlotProps-e80d3e5c.js";import"./Popper-f5917873.js";import"./index.esm-289835b5.js";import"./InfoIcon-d7130bbb.js";import"./generateCategoricalChart-3c01134b.js";import"./NoFilterResultIcon-7075db24.js";import"./index-134efb9a.js";import"./index-37ba1bf2.js";import"./CheckIcon-299d14a4.js";function Lo(t){return We("PrivateSwitchBase",t)}Ue("PrivateSwitchBase",["root","checked","disabled","input","edgeStart","edgeEnd"]);const Wo=["autoFocus","checked","checkedIcon","className","defaultChecked","disabled","disableFocusRipple","edge","icon","id","inputProps","inputRef","name","onBlur","onChange","onFocus","readOnly","required","tabIndex","type","value"],Uo=t=>{const{classes:o,checked:r,disabled:e,edge:a}=t,c={root:["root",r&&"checked",e&&"disabled",a&&`edge${le(a)}`],input:["input"]};return He(c,Lo,o)},Yo=de(wo)(({ownerState:t})=>W({padding:9,borderRadius:"50%"},t.edge==="start"&&{marginLeft:t.size==="small"?-3:-12},t.edge==="end"&&{marginRight:t.size==="small"?-3:-12})),Go=de("input",{shouldForwardProp:to})({cursor:"inherit",position:"absolute",opacity:0,width:"100%",height:"100%",top:0,left:0,margin:0,padding:0,zIndex:1}),Ho=b.forwardRef(function(o,r){const{autoFocus:e,checked:a,checkedIcon:c,className:d,defaultChecked:i,disabled:l,disableFocusRipple:v=!1,edge:u=!1,icon:h,id:f,inputProps:x,inputRef:m,name:k,onBlur:T,onChange:y,onFocus:P,readOnly:_,required:M=!1,tabIndex:w,type:g,value:E}=o,A=Ye(o,Wo),[R,O]=$o({controlled:a,default:!!i,name:"SwitchBase",state:"checked"}),B=No(),re=G=>{P&&P(G),B&&B.onFocus&&B.onFocus(G)},z=G=>{T&&T(G),B&&B.onBlur&&B.onBlur(G)},Z=G=>{if(G.nativeEvent.defaultPrevented)return;const ie=G.target.checked;O(ie),y&&y(G,ie)};let V=l;B&&typeof V>"u"&&(V=B.disabled);const U=g==="checkbox"||g==="radio",Q=W({},o,{checked:R,disabled:V,disableFocusRipple:v,edge:u}),K=Uo(Q);return n.jsxs(Yo,W({component:"span",className:Ge(K.root,d),centerRipple:!0,focusRipple:!v,disabled:V,tabIndex:null,role:void 0,onFocus:re,onBlur:z,ownerState:Q,ref:r},A,{children:[n.jsx(Go,W({autoFocus:e,checked:a,defaultChecked:i,className:K.input,disabled:V,id:U?f:void 0,name:k,onChange:Z,readOnly:_,ref:m,required:M,ownerState:Q,tabIndex:w,type:g},g==="checkbox"&&E===void 0?{}:{value:E},x)),R?c:h]}))}),Zo=Ho,Ko=b.createContext(),yt=Ko;function Xo(t){return We("MuiGrid",t)}const qo=[0,1,2,3,4,5,6,7,8,9,10],Qo=["column-reverse","column","row-reverse","row"],Jo=["nowrap","wrap-reverse","wrap"],ye=["auto",!0,1,2,3,4,5,6,7,8,9,10,11,12],en=Ue("MuiGrid",["root","container","item","zeroMinWidth",...qo.map(t=>`spacing-xs-${t}`),...Qo.map(t=>`direction-xs-${t}`),...Jo.map(t=>`wrap-xs-${t}`),...ye.map(t=>`grid-xs-${t}`),...ye.map(t=>`grid-sm-${t}`),...ye.map(t=>`grid-md-${t}`),...ye.map(t=>`grid-lg-${t}`),...ye.map(t=>`grid-xl-${t}`)]),je=en,tn=["className","columns","columnSpacing","component","container","direction","item","rowSpacing","spacing","wrap","zeroMinWidth"];function me(t){const o=parseFloat(t);return`${o}${String(t).replace(String(o),"")||"px"}`}function on({theme:t,ownerState:o}){let r;return t.breakpoints.keys.reduce((e,a)=>{let c={};if(o[a]&&(r=o[a]),!r)return e;if(r===!0)c={flexBasis:0,flexGrow:1,maxWidth:"100%"};else if(r==="auto")c={flexBasis:"auto",flexGrow:0,flexShrink:0,maxWidth:"none",width:"auto"};else{const d=Ne({values:o.columns,breakpoints:t.breakpoints.values}),i=typeof d=="object"?d[a]:d;if(i==null)return e;const l=`${Math.round(r/i*1e8)/1e6}%`;let v={};if(o.container&&o.item&&o.columnSpacing!==0){const u=t.spacing(o.columnSpacing);if(u!=="0px"){const h=`calc(${l} + ${me(u)})`;v={flexBasis:h,maxWidth:h}}}c=W({flexBasis:l,flexGrow:0,maxWidth:l},v)}return t.breakpoints.values[a]===0?Object.assign(e,c):e[t.breakpoints.up(a)]=c,e},{})}function nn({theme:t,ownerState:o}){const r=Ne({values:o.direction,breakpoints:t.breakpoints.values});return Ze({theme:t},r,e=>{const a={flexDirection:e};return e.indexOf("column")===0&&(a[`& > .${je.item}`]={maxWidth:"none"}),a})}function Bt({breakpoints:t,values:o}){let r="";Object.keys(o).forEach(a=>{r===""&&o[a]!==0&&(r=a)});const e=Object.keys(t).sort((a,c)=>t[a]-t[c]);return e.slice(0,e.indexOf(r))}function sn({theme:t,ownerState:o}){const{container:r,rowSpacing:e}=o;let a={};if(r&&e!==0){const c=Ne({values:e,breakpoints:t.breakpoints.values});let d;typeof c=="object"&&(d=Bt({breakpoints:t.breakpoints.values,values:c})),a=Ze({theme:t},c,(i,l)=>{var v;const u=t.spacing(i);return u!=="0px"?{marginTop:`-${me(u)}`,[`& > .${je.item}`]:{paddingTop:me(u)}}:(v=d)!=null&&v.includes(l)?{}:{marginTop:0,[`& > .${je.item}`]:{paddingTop:0}}})}return a}function rn({theme:t,ownerState:o}){const{container:r,columnSpacing:e}=o;let a={};if(r&&e!==0){const c=Ne({values:e,breakpoints:t.breakpoints.values});let d;typeof c=="object"&&(d=Bt({breakpoints:t.breakpoints.values,values:c})),a=Ze({theme:t},c,(i,l)=>{var v;const u=t.spacing(i);return u!=="0px"?{width:`calc(100% + ${me(u)})`,marginLeft:`-${me(u)}`,[`& > .${je.item}`]:{paddingLeft:me(u)}}:(v=d)!=null&&v.includes(l)?{}:{width:"100%",marginLeft:0,[`& > .${je.item}`]:{paddingLeft:0}}})}return a}function an(t,o,r={}){if(!t||t<=0)return[];if(typeof t=="string"&&!Number.isNaN(Number(t))||typeof t=="number")return[r[`spacing-xs-${String(t)}`]];const e=[];return o.forEach(a=>{const c=t[a];Number(c)>0&&e.push(r[`spacing-${a}-${String(c)}`])}),e}const cn=de("div",{name:"MuiGrid",slot:"Root",overridesResolver:(t,o)=>{const{ownerState:r}=t,{container:e,direction:a,item:c,spacing:d,wrap:i,zeroMinWidth:l,breakpoints:v}=r;let u=[];e&&(u=an(d,v,o));const h=[];return v.forEach(f=>{const x=r[f];x&&h.push(o[`grid-${f}-${String(x)}`])}),[o.root,e&&o.container,c&&o.item,l&&o.zeroMinWidth,...u,a!=="row"&&o[`direction-xs-${String(a)}`],i!=="wrap"&&o[`wrap-xs-${String(i)}`],...h]}})(({ownerState:t})=>W({boxSizing:"border-box"},t.container&&{display:"flex",flexWrap:"wrap",width:"100%"},t.item&&{margin:0},t.zeroMinWidth&&{minWidth:0},t.wrap!=="wrap"&&{flexWrap:t.wrap}),nn,sn,rn,on);function ln(t,o){if(!t||t<=0)return[];if(typeof t=="string"&&!Number.isNaN(Number(t))||typeof t=="number")return[`spacing-xs-${String(t)}`];const r=[];return o.forEach(e=>{const a=t[e];if(Number(a)>0){const c=`spacing-${e}-${String(a)}`;r.push(c)}}),r}const dn=t=>{const{classes:o,container:r,direction:e,item:a,spacing:c,wrap:d,zeroMinWidth:i,breakpoints:l}=t;let v=[];r&&(v=ln(c,l));const u=[];l.forEach(f=>{const x=t[f];x&&u.push(`grid-${f}-${String(x)}`)});const h={root:["root",r&&"container",a&&"item",i&&"zeroMinWidth",...v,e!=="row"&&`direction-xs-${String(e)}`,d!=="wrap"&&`wrap-xs-${String(d)}`,...u]};return He(h,Xo,o)},un=b.forwardRef(function(o,r){const e=_t({props:o,name:"MuiGrid"}),{breakpoints:a}=oo(),c=Co(e),{className:d,columns:i,columnSpacing:l,component:v="div",container:u=!1,direction:h="row",item:f=!1,rowSpacing:x,spacing:m=0,wrap:k="wrap",zeroMinWidth:T=!1}=c,y=Ye(c,tn),P=x||m,_=l||m,M=b.useContext(yt),w=u?i||12:M,g={},E=W({},y);a.keys.forEach(O=>{y[O]!=null&&(g[O]=y[O],delete E[O])});const A=W({},c,{columns:w,container:u,direction:h,item:f,rowSpacing:P,columnSpacing:_,wrap:k,zeroMinWidth:T,spacing:m},g,{breakpoints:a.keys}),R=dn(A);return n.jsx(yt.Provider,{value:w,children:n.jsx(cn,W({ownerState:A,className:Ge(R.root,d),as:v,ref:r},E))})}),ce=un;function pn(t){return We("MuiSwitch",t)}const fn=Ue("MuiSwitch",["root","edgeStart","edgeEnd","switchBase","colorPrimary","colorSecondary","sizeSmall","sizeMedium","checked","disabled","input","thumb","track"]),H=fn,hn=["className","color","edge","size","sx"],mn=t=>{const{classes:o,edge:r,size:e,color:a,checked:c,disabled:d}=t,i={root:["root",r&&`edge${le(r)}`,`size${le(e)}`],switchBase:["switchBase",`color${le(a)}`,c&&"checked",d&&"disabled"],thumb:["thumb"],track:["track"],input:["input"]},l=He(i,pn,o);return W({},o,l)},gn=de("span",{name:"MuiSwitch",slot:"Root",overridesResolver:(t,o)=>{const{ownerState:r}=t;return[o.root,r.edge&&o[`edge${le(r.edge)}`],o[`size${le(r.size)}`]]}})(({ownerState:t})=>W({display:"inline-flex",width:34+12*2,height:14+12*2,overflow:"hidden",padding:12,boxSizing:"border-box",position:"relative",flexShrink:0,zIndex:0,verticalAlign:"middle","@media print":{colorAdjust:"exact"}},t.edge==="start"&&{marginLeft:-8},t.edge==="end"&&{marginRight:-8},t.size==="small"&&{width:40,height:24,padding:7,[`& .${H.thumb}`]:{width:16,height:16},[`& .${H.switchBase}`]:{padding:4,[`&.${H.checked}`]:{transform:"translateX(16px)"}}})),bn=de(Zo,{name:"MuiSwitch",slot:"SwitchBase",overridesResolver:(t,o)=>{const{ownerState:r}=t;return[o.switchBase,{[`& .${H.input}`]:o.input},r.color!=="default"&&o[`color${le(r.color)}`]]}})(({theme:t})=>({position:"absolute",top:0,left:0,zIndex:1,color:t.vars?t.vars.palette.Switch.defaultColor:`${t.palette.mode==="light"?t.palette.common.white:t.palette.grey[300]}`,transition:t.transitions.create(["left","transform"],{duration:t.transitions.duration.shortest}),[`&.${H.checked}`]:{transform:"translateX(20px)"},[`&.${H.disabled}`]:{color:t.vars?t.vars.palette.Switch.defaultDisabledColor:`${t.palette.mode==="light"?t.palette.grey[100]:t.palette.grey[600]}`},[`&.${H.checked} + .${H.track}`]:{opacity:.5},[`&.${H.disabled} + .${H.track}`]:{opacity:t.vars?t.vars.opacity.switchTrackDisabled:`${t.palette.mode==="light"?.12:.2}`},[`& .${H.input}`]:{left:"-100%",width:"300%"}}),({theme:t,ownerState:o})=>W({"&:hover":{backgroundColor:t.vars?`rgba(${t.vars.palette.action.activeChannel} / ${t.vars.palette.action.hoverOpacity})`:lt(t.palette.action.active,t.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}}},o.color!=="default"&&{[`&.${H.checked}`]:{color:(t.vars||t).palette[o.color].main,"&:hover":{backgroundColor:t.vars?`rgba(${t.vars.palette[o.color].mainChannel} / ${t.vars.palette.action.hoverOpacity})`:lt(t.palette[o.color].main,t.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}},[`&.${H.disabled}`]:{color:t.vars?t.vars.palette.Switch[`${o.color}DisabledColor`]:`${t.palette.mode==="light"?no(t.palette[o.color].main,.62):so(t.palette[o.color].main,.55)}`}},[`&.${H.checked} + .${H.track}`]:{backgroundColor:(t.vars||t).palette[o.color].main}})),xn=de("span",{name:"MuiSwitch",slot:"Track",overridesResolver:(t,o)=>o.track})(({theme:t})=>({height:"100%",width:"100%",borderRadius:14/2,zIndex:-1,transition:t.transitions.create(["opacity","background-color"],{duration:t.transitions.duration.shortest}),backgroundColor:t.vars?t.vars.palette.common.onBackground:`${t.palette.mode==="light"?t.palette.common.black:t.palette.common.white}`,opacity:t.vars?t.vars.opacity.switchTrack:`${t.palette.mode==="light"?.38:.3}`})),yn=de("span",{name:"MuiSwitch",slot:"Thumb",overridesResolver:(t,o)=>o.thumb})(({theme:t})=>({boxShadow:(t.vars||t).shadows[1],backgroundColor:"currentColor",width:20,height:20,borderRadius:"50%"})),wn=b.forwardRef(function(o,r){const e=_t({props:o,name:"MuiSwitch"}),{className:a,color:c="primary",edge:d=!1,size:i="medium",sx:l}=e,v=Ye(e,hn),u=W({},e,{color:c,edge:d,size:i}),h=mn(u),f=n.jsx(yn,{className:h.thumb,ownerState:u});return n.jsxs(gn,{className:Ge(h.root,a),sx:l,ownerState:u,children:[n.jsx(bn,W({type:"checkbox",icon:f,checkedIcon:f,ref:r,ownerState:u},v,{classes:W({},h,{root:h.switchBase})})),n.jsx(xn,{className:h.track,ownerState:u})]})}),jn=wn,vn={schemas:[],links:[]},Dt=ro(t=>({...vn,setSchemas:o=>{t({schemas:o})},setSchemaLinks:o=>{t({links:o})}})),En=/^[a-z0-9_]+$/,Pn=({parentParam:t,onDelete:o})=>{const[r,e]=b.useState(!1),[a,c]=b.useState([]),{fields:d,append:i,replace:l,remove:v}=jo({name:"attributes"}),{setValue:u,watch:h}=vo();return b.useEffect(()=>{const f=async()=>{try{let x=[{required:!1,type:"string",key:""}];if(t!==To.value.toLowerCase()){e(!0);const m=await io(t);x=ko(m)}x=x.filter(m=>m.key!=="node_key"),l(x),c(x)}catch(x){console.warn(x)}finally{e(!1)}};a.length===0&&f()},[t,u,l,a.length]),n.jsxs(n.Fragment,{children:[r?n.jsx(j,{align:"center",children:n.jsx(we,{color:D.SECONDARY_BLUE,size:"30"})}):n.jsx(Cn,{py:8,children:n.jsx(ce,{container:!0,spacing:2,children:d.map((f,x)=>{const m=h(`attributes[${x}].type`),k=h(`attributes[${x}].required`),T=f.isNew||!1,y=["name"].includes(h(`attributes[${x}].key`));return n.jsxs(b.Fragment,{children:[n.jsx(ce,{item:!0,xs:5,children:n.jsx(_e,{autoComplete:"off",className:"text-input",disabled:!T,id:"cy-item-name",maxLength:50,name:`attributes.${x}.key`,placeholder:"Enter value",rules:{...Me,pattern:{message:"Please avoid special characters, spaces and uppercase",value:En}}})}),n.jsx(ce,{item:!0,xs:4,children:n.jsx(Ae,{disabled:y,onSelect:P=>u(`attributes[${x}].type`,P==null?void 0:P.value),options:bt,selectedValue:bt.find(P=>P.value===m)})}),n.jsxs(ce,{item:!0,xs:3,children:[n.jsx(jn,{checked:k,disabled:y,name:`attributes.${x}.required`,onChange:P=>u(`attributes[${x}].required`,P.target.checked),size:"small"}),!y&&n.jsx(Eo,{onClick:()=>{v(x),f.key!==void 0&&o&&o(f.key)},children:n.jsx(Oo,{})})]})]},f.id)})})}),n.jsx(j,{align:"flex-start",py:12,children:n.jsx(ve,{onClick:()=>i({key:"",type:"string",required:!0,isNew:!0}),size:"medium",startIcon:n.jsx(Mo,{}),variant:"contained",children:"Add Attribute"})})]})},Cn=F(j)`
  overflow-y: auto;
  width: calc(100% + 20px);
  max-height: calc(80vh - 300px);
`,Tn=({parent:t,onDelete:o})=>{const r=t;return n.jsxs(j,{children:[n.jsx(j,{direction:"row",mb:10,children:n.jsxs(ce,{container:!0,spacing:2,children:[n.jsx(ce,{item:!0,xs:5,children:n.jsx(De,{style:{marginRight:180},children:"Attributes"})}),n.jsx(ce,{item:!0,xs:4,children:n.jsx(De,{style:{marginRight:130},children:"Type"})}),n.jsx(ce,{item:!0,xs:3,children:n.jsx(De,{children:"Required"})})]})}),r&&n.jsx(Pn,{onDelete:o,parentParam:r},r)]})},De=F(q)`
  font-size: 15px;
  color: gray;
`,Sn={type:"",parent:""},On=async(t,o=!1,r)=>{try{const{attributes:e,...a}=t,c={...a,attributes:Ao(e),...r.reduce((i,l)=>({...i,[l]:"delete"}),{})};let d;if(o?d=await ke.put("/schema",JSON.stringify(c),{}):d=await ke.post("/schema",JSON.stringify({...c,node_key:"name"}),{}),d.status!=="success")throw new Error("error");return d==null?void 0:d.ref_id}catch(e){let a=he;if(e.status===400){const c=await e.json();a=c.errorCode||(c==null?void 0:c.status)||he}else e instanceof Error&&(a=e.message);throw new Error(a)}},Mn=t=>t.charAt(0).toUpperCase()+t.slice(1),wt=async(t,o)=>{try{const c=((await $t()).schemas||[]).filter(d=>!d.is_deleted&&d.type&&(!o||o(d))).map(d=>d.type==="thing"?{label:"No Parent",value:d.type}:{label:Mn(d.type),value:d.type});t(c)}catch(r){console.warn(r)}},kn=({graphLoading:t,onSchemaCreate:o,selectedSchema:r,onDelete:e,setSelectedSchemaId:a,setGraphLoading:c,setIsCreateNew:d,onSchemaUpdate:i})=>{const{close:l,visible:v}=Nt("addType"),u=Ke({mode:"onChange",defaultValues:r?{type:r.type,parent:r.parent}:Sn}),{watch:h,setValue:f,reset:x,getValues:m}=u,[k,T]=b.useState(!1),[y,P]=b.useState(!1),[_,M]=b.useState(null),[w,g]=b.useState(!1),[E,A]=b.useState(null),[R,O]=b.useState(""),[B,re]=b.useState(null),[z,Z]=b.useState([]);b.useEffect(()=>()=>{x()},[v,x]);const V=()=>{d(!1),a("")};b.useEffect(()=>{r||(P(!0),wt(M).finally(()=>P(!1)))},[r]),b.useEffect(()=>{r&&(f("type",r==null?void 0:r.type),f("parent",r.parent),wt(A,$=>$.type!==r.type&&$.type!==r.parent))},[r,f]);const U=h("parent"),Q=()=>{l()},K=$=>{Z(Y=>[...Y,$])},G=async()=>{if(r!=null&&r.type)try{await ke.delete(`/schema/${r.ref_id}`),e(r.type),l()}catch($){let Y=he;if(($==null?void 0:$.status)===400){const X=await $.json();Y=X.errorCode||(X==null?void 0:X.status)||he}else $ instanceof Error&&(Y=$.message);re(Y)}finally{d(!1)}},ie=u.handleSubmit(async $=>{if(!U){g(!0);return}T(!0);try{if(r&&$.type!==(r==null?void 0:r.type)||r&&m().parent!==(r==null?void 0:r.parent)){const X=m().parent??(r==null?void 0:r.parent);c(!0),await ke.put(`/schema/${r==null?void 0:r.ref_id}`,JSON.stringify({type:$.type,parent:X})),await i()}const Y=await On({...$,...r?{ref_id:r==null?void 0:r.ref_id}:{}},!!r,z);o({type:$.type,parent:U||"",ref_id:(r==null?void 0:r.ref_id)||Y||"new"}),Q()}catch(Y){let X=he;if((Y==null?void 0:Y.status)===400){const ue=await Y.json();X=ue.errorCode||(ue==null?void 0:ue.status)||he}else Y instanceof Error&&(X=Y.message);O(X)}finally{T(!1),c(!1),d(!1)}}),Ee=()=>_==null?void 0:_.find($=>$.value===U),ge=()=>E==null?void 0:E.find($=>$.value===U);return n.jsxs(j,{children:[n.jsx(j,{direction:"row",justify:"flex-end",children:n.jsx(_n,{"data-testid":"close-sidebar-sub-view",onClick:V,children:n.jsx(It,{})})}),n.jsx(j,{children:n.jsx(zt,{...u,children:n.jsxs("form",{id:"add-type-form",onSubmit:ie,children:[n.jsx(j,{children:r?n.jsxs(n.Fragment,{children:[n.jsxs(j,{mb:12,children:[n.jsx(j,{mb:12,children:n.jsx(q,{children:"Name"})}),n.jsx(j,{mb:12,children:n.jsx(_e,{defaultValue:r==null?void 0:r.type,id:"cy-item-name",maxLength:250,name:"type",placeholder:"Enter type name",rules:{...Me},value:U})})]}),n.jsxs(j,{mb:12,children:[n.jsx(j,{mb:12,children:n.jsx(q,{children:"Parent"})}),n.jsx(Ae,{isLoading:y||t,onSelect:$=>{f("parent",($==null?void 0:$.value)||""),g(!1)},options:E||[],selectedValue:ge()}),R&&n.jsx(Fe,{children:R})]})]}):n.jsxs(n.Fragment,{children:[n.jsxs(j,{mb:12,children:[n.jsx(j,{mb:12,children:n.jsx(q,{children:"Select Parent"})}),n.jsx(Ae,{isLoading:y,onSelect:$=>{f("parent",($==null?void 0:$.value)||""),g(!1)},options:_,selectedValue:Ee()}),w&&n.jsx(Fe,{children:"A parent type must be selected"})]}),n.jsxs(j,{children:[n.jsx(j,{mb:12,children:n.jsx(q,{children:"Type name"})}),n.jsx(j,{mb:12,children:n.jsx(_e,{id:"cy-item-name",maxLength:250,name:"type",placeholder:"Enter type name",rules:{...Me},value:U})})]})]})}),n.jsx(Tn,{onDelete:K,parent:r?r.type:U}),n.jsxs(j,{direction:"row",justify:"space-between",mt:20,children:[r?n.jsxs(j,{direction:"column",children:[n.jsx(An,{color:"secondary",onClick:G,size:"large",style:{marginRight:20},variant:"contained",children:"Delete"}),B&&n.jsx(Fe,{children:B})]}):null,n.jsx(ve,{color:"secondary",disabled:k||w,onClick:ie,size:"large",startIcon:k?n.jsx(we,{color:D.white,size:10}):null,variant:"contained",children:"Save"})]})]})})})]})},An=F(ve)`
  && {
    color: ${D.primaryRed};
    background-color: rgba(237, 116, 116, 0.1);

    &:hover,
    &:active,
    &:focus {
      color: ${D.primaryRed};
      background-color: rgba(237, 116, 116, 0.2);
    }
  }
`,_n=F(j)`
  font-size: 32px;
  color: ${D.white};
  cursor: pointer;
`,Fe=F(j)`
  font-size: 13px;
  font-family: Barlow;
  color: #ff8f80;
  line-height: 0.2px;
  margin-top: 12px;
  padding-top: 20px;
`;var Nn=Object.defineProperty,$n=(t,o,r)=>o in t?Nn(t,o,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[o]=r,C=(t,o,r)=>($n(t,typeof o!="symbol"?o+"":o,r),r);const Oe=new ao,jt=new co,In=Math.cos(70*(Math.PI/180)),vt=(t,o)=>(t%o+o)%o;let zn=class extends lo{constructor(o,r){super(),C(this,"object"),C(this,"domElement"),C(this,"enabled",!0),C(this,"target",new N),C(this,"minDistance",0),C(this,"maxDistance",1/0),C(this,"minZoom",0),C(this,"maxZoom",1/0),C(this,"minPolarAngle",0),C(this,"maxPolarAngle",Math.PI),C(this,"minAzimuthAngle",-1/0),C(this,"maxAzimuthAngle",1/0),C(this,"enableDamping",!1),C(this,"dampingFactor",.05),C(this,"enableZoom",!0),C(this,"zoomSpeed",1),C(this,"enableRotate",!0),C(this,"rotateSpeed",1),C(this,"enablePan",!0),C(this,"panSpeed",1),C(this,"screenSpacePanning",!0),C(this,"keyPanSpeed",7),C(this,"zoomToCursor",!1),C(this,"autoRotate",!1),C(this,"autoRotateSpeed",2),C(this,"reverseOrbit",!1),C(this,"reverseHorizontalOrbit",!1),C(this,"reverseVerticalOrbit",!1),C(this,"keys",{LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"}),C(this,"mouseButtons",{LEFT:pe.ROTATE,MIDDLE:pe.DOLLY,RIGHT:pe.PAN}),C(this,"touches",{ONE:fe.ROTATE,TWO:fe.DOLLY_PAN}),C(this,"target0"),C(this,"position0"),C(this,"zoom0"),C(this,"_domElementKeyEvents",null),C(this,"getPolarAngle"),C(this,"getAzimuthalAngle"),C(this,"setPolarAngle"),C(this,"setAzimuthalAngle"),C(this,"getDistance"),C(this,"listenToKeyEvents"),C(this,"stopListenToKeyEvents"),C(this,"saveState"),C(this,"reset"),C(this,"update"),C(this,"connect"),C(this,"dispose"),this.object=o,this.domElement=r,this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=()=>u.phi,this.getAzimuthalAngle=()=>u.theta,this.setPolarAngle=s=>{let p=vt(s,2*Math.PI),S=u.phi;S<0&&(S+=2*Math.PI),p<0&&(p+=2*Math.PI);let I=Math.abs(p-S);2*Math.PI-I<I&&(p<S?p+=2*Math.PI:S+=2*Math.PI),h.phi=p-S,e.update()},this.setAzimuthalAngle=s=>{let p=vt(s,2*Math.PI),S=u.theta;S<0&&(S+=2*Math.PI),p<0&&(p+=2*Math.PI);let I=Math.abs(p-S);2*Math.PI-I<I&&(p<S?p+=2*Math.PI:S+=2*Math.PI),h.theta=p-S,e.update()},this.getDistance=()=>e.object.position.distanceTo(e.target),this.listenToKeyEvents=s=>{s.addEventListener("keydown",Re),this._domElementKeyEvents=s},this.stopListenToKeyEvents=()=>{this._domElementKeyEvents.removeEventListener("keydown",Re),this._domElementKeyEvents=null},this.saveState=()=>{e.target0.copy(e.target),e.position0.copy(e.object.position),e.zoom0=e.object.zoom},this.reset=()=>{e.target.copy(e.target0),e.object.position.copy(e.position0),e.object.zoom=e.zoom0,e.object.updateProjectionMatrix(),e.dispatchEvent(a),e.update(),l=i.NONE},this.update=(()=>{const s=new N,p=new N(0,1,0),S=new dt().setFromUnitVectors(o.up,p),I=S.clone().invert(),L=new N,oe=new dt,ae=2*Math.PI;return function(){const ct=e.object.position;S.setFromUnitVectors(o.up,p),I.copy(S).invert(),s.copy(ct).sub(e.target),s.applyQuaternion(S),u.setFromVector3(s),e.autoRotate&&l===i.NONE&&Z(re()),e.enableDamping?(u.theta+=h.theta*e.dampingFactor,u.phi+=h.phi*e.dampingFactor):(u.theta+=h.theta,u.phi+=h.phi);let ne=e.minAzimuthAngle,se=e.maxAzimuthAngle;isFinite(ne)&&isFinite(se)&&(ne<-Math.PI?ne+=ae:ne>Math.PI&&(ne-=ae),se<-Math.PI?se+=ae:se>Math.PI&&(se-=ae),ne<=se?u.theta=Math.max(ne,Math.min(se,u.theta)):u.theta=u.theta>(ne+se)/2?Math.max(ne,u.theta):Math.min(se,u.theta)),u.phi=Math.max(e.minPolarAngle,Math.min(e.maxPolarAngle,u.phi)),u.makeSafe(),e.enableDamping===!0?e.target.addScaledVector(x,e.dampingFactor):e.target.add(x),e.zoomToCursor&&R||e.object.isOrthographicCamera?u.radius=ge(u.radius):u.radius=ge(u.radius*f),s.setFromSpherical(u),s.applyQuaternion(I),ct.copy(e.target).add(s),e.object.matrixAutoUpdate||e.object.updateMatrix(),e.object.lookAt(e.target),e.enableDamping===!0?(h.theta*=1-e.dampingFactor,h.phi*=1-e.dampingFactor,x.multiplyScalar(1-e.dampingFactor)):(h.set(0,0,0),x.set(0,0,0));let Pe=!1;if(e.zoomToCursor&&R){let be=null;if(e.object instanceof Te&&e.object.isPerspectiveCamera){const xe=s.length();be=ge(xe*f);const Ce=xe-be;e.object.position.addScaledVector(E,Ce),e.object.updateMatrixWorld()}else if(e.object.isOrthographicCamera){const xe=new N(A.x,A.y,0);xe.unproject(e.object),e.object.zoom=Math.max(e.minZoom,Math.min(e.maxZoom,e.object.zoom/f)),e.object.updateProjectionMatrix(),Pe=!0;const Ce=new N(A.x,A.y,0);Ce.unproject(e.object),e.object.position.sub(Ce).add(xe),e.object.updateMatrixWorld(),be=s.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),e.zoomToCursor=!1;be!==null&&(e.screenSpacePanning?e.target.set(0,0,-1).transformDirection(e.object.matrix).multiplyScalar(be).add(e.object.position):(Oe.origin.copy(e.object.position),Oe.direction.set(0,0,-1).transformDirection(e.object.matrix),Math.abs(e.object.up.dot(Oe.direction))<In?o.lookAt(e.target):(jt.setFromNormalAndCoplanarPoint(e.object.up,e.target),Oe.intersectPlane(jt,e.target))))}else e.object instanceof Se&&e.object.isOrthographicCamera&&(e.object.zoom=Math.max(e.minZoom,Math.min(e.maxZoom,e.object.zoom/f)),e.object.updateProjectionMatrix(),Pe=!0);return f=1,R=!1,Pe||L.distanceToSquared(e.object.position)>v||8*(1-oe.dot(e.object.quaternion))>v?(e.dispatchEvent(a),L.copy(e.object.position),oe.copy(e.object.quaternion),Pe=!1,!0):!1}})(),this.connect=s=>{s===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),e.domElement=s,e.domElement.style.touchAction="none",e.domElement.addEventListener("contextmenu",rt),e.domElement.addEventListener("pointerdown",ot),e.domElement.addEventListener("pointercancel",nt),e.domElement.addEventListener("wheel",st)},this.dispose=()=>{var s,p,S,I,L,oe;(s=e.domElement)==null||s.removeEventListener("contextmenu",rt),(p=e.domElement)==null||p.removeEventListener("pointerdown",ot),(S=e.domElement)==null||S.removeEventListener("pointercancel",nt),(I=e.domElement)==null||I.removeEventListener("wheel",st),(L=e.domElement)==null||L.ownerDocument.removeEventListener("pointermove",Ie),(oe=e.domElement)==null||oe.ownerDocument.removeEventListener("pointerup",ze),e._domElementKeyEvents!==null&&e._domElementKeyEvents.removeEventListener("keydown",Re)};const e=this,a={type:"change"},c={type:"start"},d={type:"end"},i={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let l=i.NONE;const v=1e-6,u=new ut,h=new ut;let f=1;const x=new N,m=new J,k=new J,T=new J,y=new J,P=new J,_=new J,M=new J,w=new J,g=new J,E=new N,A=new J;let R=!1;const O=[],B={};function re(){return 2*Math.PI/60/60*e.autoRotateSpeed}function z(){return Math.pow(.95,e.zoomSpeed)}function Z(s){e.reverseOrbit||e.reverseHorizontalOrbit?h.theta+=s:h.theta-=s}function V(s){e.reverseOrbit||e.reverseVerticalOrbit?h.phi+=s:h.phi-=s}const U=(()=>{const s=new N;return function(S,I){s.setFromMatrixColumn(I,0),s.multiplyScalar(-S),x.add(s)}})(),Q=(()=>{const s=new N;return function(S,I){e.screenSpacePanning===!0?s.setFromMatrixColumn(I,1):(s.setFromMatrixColumn(I,0),s.crossVectors(e.object.up,s)),s.multiplyScalar(S),x.add(s)}})(),K=(()=>{const s=new N;return function(S,I){const L=e.domElement;if(L&&e.object instanceof Te&&e.object.isPerspectiveCamera){const oe=e.object.position;s.copy(oe).sub(e.target);let ae=s.length();ae*=Math.tan(e.object.fov/2*Math.PI/180),U(2*S*ae/L.clientHeight,e.object.matrix),Q(2*I*ae/L.clientHeight,e.object.matrix)}else L&&e.object instanceof Se&&e.object.isOrthographicCamera?(U(S*(e.object.right-e.object.left)/e.object.zoom/L.clientWidth,e.object.matrix),Q(I*(e.object.top-e.object.bottom)/e.object.zoom/L.clientHeight,e.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),e.enablePan=!1)}})();function G(s){e.object instanceof Te&&e.object.isPerspectiveCamera||e.object instanceof Se&&e.object.isOrthographicCamera?f/=s:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),e.enableZoom=!1)}function ie(s){e.object instanceof Te&&e.object.isPerspectiveCamera||e.object instanceof Se&&e.object.isOrthographicCamera?f*=s:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),e.enableZoom=!1)}function Ee(s){if(!e.zoomToCursor||!e.domElement)return;R=!0;const p=e.domElement.getBoundingClientRect(),S=s.clientX-p.left,I=s.clientY-p.top,L=p.width,oe=p.height;A.x=S/L*2-1,A.y=-(I/oe)*2+1,E.set(A.x,A.y,1).unproject(e.object).sub(e.object.position).normalize()}function ge(s){return Math.max(e.minDistance,Math.min(e.maxDistance,s))}function $(s){m.set(s.clientX,s.clientY)}function Y(s){Ee(s),M.set(s.clientX,s.clientY)}function X(s){y.set(s.clientX,s.clientY)}function ue(s){k.set(s.clientX,s.clientY),T.subVectors(k,m).multiplyScalar(e.rotateSpeed);const p=e.domElement;p&&(Z(2*Math.PI*T.x/p.clientHeight),V(2*Math.PI*T.y/p.clientHeight)),m.copy(k),e.update()}function Lt(s){w.set(s.clientX,s.clientY),g.subVectors(w,M),g.y>0?G(z()):g.y<0&&ie(z()),M.copy(w),e.update()}function Wt(s){P.set(s.clientX,s.clientY),_.subVectors(P,y).multiplyScalar(e.panSpeed),K(_.x,_.y),y.copy(P),e.update()}function Ut(s){Ee(s),s.deltaY<0?ie(z()):s.deltaY>0&&G(z()),e.update()}function Yt(s){let p=!1;switch(s.code){case e.keys.UP:K(0,e.keyPanSpeed),p=!0;break;case e.keys.BOTTOM:K(0,-e.keyPanSpeed),p=!0;break;case e.keys.LEFT:K(e.keyPanSpeed,0),p=!0;break;case e.keys.RIGHT:K(-e.keyPanSpeed,0),p=!0;break}p&&(s.preventDefault(),e.update())}function Xe(){if(O.length==1)m.set(O[0].pageX,O[0].pageY);else{const s=.5*(O[0].pageX+O[1].pageX),p=.5*(O[0].pageY+O[1].pageY);m.set(s,p)}}function qe(){if(O.length==1)y.set(O[0].pageX,O[0].pageY);else{const s=.5*(O[0].pageX+O[1].pageX),p=.5*(O[0].pageY+O[1].pageY);y.set(s,p)}}function Qe(){const s=O[0].pageX-O[1].pageX,p=O[0].pageY-O[1].pageY,S=Math.sqrt(s*s+p*p);M.set(0,S)}function Gt(){e.enableZoom&&Qe(),e.enablePan&&qe()}function Ht(){e.enableZoom&&Qe(),e.enableRotate&&Xe()}function Je(s){if(O.length==1)k.set(s.pageX,s.pageY);else{const S=Be(s),I=.5*(s.pageX+S.x),L=.5*(s.pageY+S.y);k.set(I,L)}T.subVectors(k,m).multiplyScalar(e.rotateSpeed);const p=e.domElement;p&&(Z(2*Math.PI*T.x/p.clientHeight),V(2*Math.PI*T.y/p.clientHeight)),m.copy(k)}function et(s){if(O.length==1)P.set(s.pageX,s.pageY);else{const p=Be(s),S=.5*(s.pageX+p.x),I=.5*(s.pageY+p.y);P.set(S,I)}_.subVectors(P,y).multiplyScalar(e.panSpeed),K(_.x,_.y),y.copy(P)}function tt(s){const p=Be(s),S=s.pageX-p.x,I=s.pageY-p.y,L=Math.sqrt(S*S+I*I);w.set(0,L),g.set(0,Math.pow(w.y/M.y,e.zoomSpeed)),G(g.y),M.copy(w)}function Zt(s){e.enableZoom&&tt(s),e.enablePan&&et(s)}function Kt(s){e.enableZoom&&tt(s),e.enableRotate&&Je(s)}function ot(s){var p,S;e.enabled!==!1&&(O.length===0&&((p=e.domElement)==null||p.ownerDocument.addEventListener("pointermove",Ie),(S=e.domElement)==null||S.ownerDocument.addEventListener("pointerup",ze)),eo(s),s.pointerType==="touch"?Qt(s):Xt(s))}function Ie(s){e.enabled!==!1&&(s.pointerType==="touch"?Jt(s):qt(s))}function ze(s){var p,S,I;it(s),O.length===0&&((p=e.domElement)==null||p.releasePointerCapture(s.pointerId),(S=e.domElement)==null||S.ownerDocument.removeEventListener("pointermove",Ie),(I=e.domElement)==null||I.ownerDocument.removeEventListener("pointerup",ze)),e.dispatchEvent(d),l=i.NONE}function nt(s){it(s)}function Xt(s){let p;switch(s.button){case 0:p=e.mouseButtons.LEFT;break;case 1:p=e.mouseButtons.MIDDLE;break;case 2:p=e.mouseButtons.RIGHT;break;default:p=-1}switch(p){case pe.DOLLY:if(e.enableZoom===!1)return;Y(s),l=i.DOLLY;break;case pe.ROTATE:if(s.ctrlKey||s.metaKey||s.shiftKey){if(e.enablePan===!1)return;X(s),l=i.PAN}else{if(e.enableRotate===!1)return;$(s),l=i.ROTATE}break;case pe.PAN:if(s.ctrlKey||s.metaKey||s.shiftKey){if(e.enableRotate===!1)return;$(s),l=i.ROTATE}else{if(e.enablePan===!1)return;X(s),l=i.PAN}break;default:l=i.NONE}l!==i.NONE&&e.dispatchEvent(c)}function qt(s){if(e.enabled!==!1)switch(l){case i.ROTATE:if(e.enableRotate===!1)return;ue(s);break;case i.DOLLY:if(e.enableZoom===!1)return;Lt(s);break;case i.PAN:if(e.enablePan===!1)return;Wt(s);break}}function st(s){e.enabled===!1||e.enableZoom===!1||l!==i.NONE&&l!==i.ROTATE||(s.preventDefault(),e.dispatchEvent(c),Ut(s),e.dispatchEvent(d))}function Re(s){e.enabled===!1||e.enablePan===!1||Yt(s)}function Qt(s){switch(at(s),O.length){case 1:switch(e.touches.ONE){case fe.ROTATE:if(e.enableRotate===!1)return;Xe(),l=i.TOUCH_ROTATE;break;case fe.PAN:if(e.enablePan===!1)return;qe(),l=i.TOUCH_PAN;break;default:l=i.NONE}break;case 2:switch(e.touches.TWO){case fe.DOLLY_PAN:if(e.enableZoom===!1&&e.enablePan===!1)return;Gt(),l=i.TOUCH_DOLLY_PAN;break;case fe.DOLLY_ROTATE:if(e.enableZoom===!1&&e.enableRotate===!1)return;Ht(),l=i.TOUCH_DOLLY_ROTATE;break;default:l=i.NONE}break;default:l=i.NONE}l!==i.NONE&&e.dispatchEvent(c)}function Jt(s){switch(at(s),l){case i.TOUCH_ROTATE:if(e.enableRotate===!1)return;Je(s),e.update();break;case i.TOUCH_PAN:if(e.enablePan===!1)return;et(s),e.update();break;case i.TOUCH_DOLLY_PAN:if(e.enableZoom===!1&&e.enablePan===!1)return;Zt(s),e.update();break;case i.TOUCH_DOLLY_ROTATE:if(e.enableZoom===!1&&e.enableRotate===!1)return;Kt(s),e.update();break;default:l=i.NONE}}function rt(s){e.enabled!==!1&&s.preventDefault()}function eo(s){O.push(s)}function it(s){delete B[s.pointerId];for(let p=0;p<O.length;p++)if(O[p].pointerId==s.pointerId){O.splice(p,1);return}}function at(s){let p=B[s.pointerId];p===void 0&&(p=new J,B[s.pointerId]=p),p.set(s.pageX,s.pageY)}function Be(s){const p=s.pointerId===O[0].pointerId?O[1]:O[0];return B[p.pointerId]}r!==void 0&&this.connect(r),this.update()}};const Rn=new N,Et=b.forwardRef(function({start:o=[0,0,0],end:r=[0,0,0],mid:e,segments:a=20,...c},d){const i=b.useRef(null),[l]=b.useState(()=>new uo(void 0,void 0,void 0)),v=b.useCallback((h,f,x,m=20)=>(h instanceof N?l.v0.copy(h):l.v0.set(...h),f instanceof N?l.v2.copy(f):l.v2.set(...f),x instanceof N?l.v1.copy(x):l.v1.copy(l.v0.clone().add(l.v2.clone().sub(l.v0)).add(Rn.set(0,l.v0.y-l.v2.y,0))),l.getPoints(m)),[]);b.useLayoutEffect(()=>{i.current.setPoints=(h,f,x)=>{const m=v(h,f,x);i.current.geometry&&i.current.geometry.setPositions(m.map(k=>k.toArray()).flat())}},[]);const u=b.useMemo(()=>v(o,r,e,a),[o,r,e,a]);return b.createElement(Io,W({ref:zo([i,d]),points:u},c))}),Bn=b.forwardRef(({makeDefault:t,camera:o,regress:r,domElement:e,enableDamping:a=!0,onChange:c,onStart:d,onEnd:i,...l},v)=>{const u=te(w=>w.invalidate),h=te(w=>w.camera),f=te(w=>w.gl),x=te(w=>w.events),m=te(w=>w.setEvents),k=te(w=>w.set),T=te(w=>w.get),y=te(w=>w.performance),P=o||h,_=e||x.connected||f.domElement,M=b.useMemo(()=>new zn(P),[P]);return $e(()=>{M.enabled&&M.update()},-1),b.useEffect(()=>(M.connect(_),()=>void M.dispose()),[_,r,M,u]),b.useEffect(()=>{const w=A=>{u(),r&&y.regress(),c&&c(A)},g=A=>{d&&d(A)},E=A=>{i&&i(A)};return M.addEventListener("change",w),M.addEventListener("start",g),M.addEventListener("end",E),()=>{M.removeEventListener("start",g),M.removeEventListener("end",E),M.removeEventListener("change",w)}},[c,d,i,M,u,m]),b.useEffect(()=>{if(t){const w=T().controls;return k({controls:M}),()=>k({controls:w})}},[t,M]),b.createElement("primitive",W({ref:v,object:M,enableDamping:a},l))});function Dn(t){const o=t+"Geometry";return b.forwardRef(({args:r,children:e,...a},c)=>b.createElement("mesh",W({ref:c},a),b.createElement(o,{attach:"geometry",args:r}),e))}const Fn=Dn("circle"),Pt=t=>{const o=b.useRef();return b.useEffect(()=>{o.current=t}),o.current},ee=10,Vn=2,Ln=2,Ct=10,Wn=10,Tt=(t,o,r)=>{const c=new N().subVectors(o,t).normalize().multiplyScalar(r);return new N().addVectors(t,c)},Un=(t,o,r,e)=>{const a=new N().lerpVectors(t,o,.5),c=new N().subVectors(o,t).normalize(),d=new N(-c.y,c.x,c.z).normalize(),i=(r-e/2)*Wn;return new N().addVectors(a,d.multiplyScalar(i))},Ft=({links:t,nodes:o,onEdgeClick:r})=>{const e=b.useRef(null),{camera:a}=te(),c=new N,d=new N,i=new N,l=new N,v=new N,u=new N,h=new N,f=new N;$e(()=>{e.current&&o&&e.current.children.forEach((m,k)=>{var R,O,B,re;const T=t[k];if(!T)return;const y=o.find(z=>z.ref_id===T.source),P=o.find(z=>z.ref_id===T.target);c.set((P==null?void 0:P.x)||0,(P==null?void 0:P.y)||0,(P==null?void 0:P.z)||0),d.set((y==null?void 0:y.x)||0,(y==null?void 0:y.y)||0,(y==null?void 0:y.z)||0);const _=m.children[0],M=m.children[1],w=m.children[2],g=m.children[3],E=t.filter(z=>z.source===T.source&&z.target===T.target||z.source===T.target&&z.target===T.source).length,A=t.filter((z,Z)=>Z<k&&(z.source===T.source&&z.target===T.target||z.source===T.target&&z.target===T.source)).length;if((P==null?void 0:P.ref_id)===(y==null?void 0:y.ref_id)){const[z,Z,V]=_o(c);(R=_.setPoints)==null||R.call(_,c,V,z),(O=M.setPoints)==null||O.call(M,V,d,z),w.position.set(V.x,V.y,Z.z),w.lookAt(z),w.rotateX(-Math.PI/2),g.position.set(V.x,V.y,Z.z),g.lookAt(a.position)}else{f.copy(Tt(c,d,ee)),h.copy(Tt(d,c,ee+.5)),i.lerpVectors(f,h,.5),E>1?i.copy(Un(f,h,A,E)):i.lerpVectors(f,h,.5);const z=30;l.subVectors(h,f).normalize().multiplyScalar(z/2),v.subVectors(i,l),u.addVectors(i,l);const Z=new N().addVectors(f,v).multiplyScalar(.5),V=new N().addVectors(u,h).multiplyScalar(.5);(B=_.setPoints)==null||B.call(_,f,v,Z),(re=M.setPoints)==null||re.call(M,u,h,V),w.position.set(h.x,h.y,h.z),w.lookAt(f),w.rotateX(-Math.PI/2),g.position.set(i.x,i.y,i.z),g.lookAt(a.position);let U=Math.atan2(h.y-f.y,h.x-f.x);(U>Math.PI/2||U<-Math.PI/2)&&(U+=Math.PI),g.rotation.set(0,0,U);const Q=f.distanceTo(h),K=Q<z?2:4;Q<z?g.text=Le(T.edge_type,Ct):g.text=T.edge_type,g.fontSize=K}})});const x=(m,k,T,y)=>{if(m==="CHILD_OF"||k==="string"||T==="string")return;const P=o==null?void 0:o.find(g=>g.ref_id===k),_=o==null?void 0:o.find(g=>g.ref_id===T),M=(P==null?void 0:P.type)||"",w=(_==null?void 0:_.type)||"";r(y,m,M,w)};return n.jsx("group",{ref:e,children:t.map(m=>n.jsxs("group",{children:[n.jsx(Et,{color:"white",end:[0,0,0],lineWidth:1,start:[0,0,0]}),n.jsx(Et,{color:"white",end:[0,0,0],lineWidth:1,start:[0,0,0]}),n.jsxs("mesh",{position:new N(0,0,0),children:[n.jsx("coneGeometry",{args:[Vn,Ln,32]}),n.jsx("meshBasicMaterial",{color:"white"})]}),n.jsx(Rt,{anchorX:"center",anchorY:"middle",color:"white",fontSize:4,lineHeight:1,maxWidth:20,onClick:()=>x(m.edge_type,m.source,m.target,m.ref_id),rotation:[0,0,0],textAlign:"center",children:Le(m.edge_type,Ct)})]},m.ref_id))})};Ft.displayName="Lines";const Yn=["#ff13c9","#5af0ff","#3233ff","#c2f0c2","#ff6666","#99ccff","#ffb3b3"],Gn=F.div`
  color: white;
  background: rgba(0, 0, 0, 1);
  padding: 2px 5px;
  border-radius: 4px;
  word-wrap: break-word;
  text-align: center;
  white-space: nowrap;
  visibility: visible;
  font-size: 12px;
  font-style: normal;
  font-weight: 400;
`,Hn=F(Ro)`
  position: absolute;
`;new po(2,2,2);const Vt=b.memo(({node:t,setSelectedNode:o,onSimulationUpdate:r,isSelected:e})=>{var k;const a=b.useRef(null),[c,d]=b.useState(!1);console.log(e);const{size:i,camera:l}=te(),v=Po(T=>{if(t.type==="Thing")return;const{xy:[y,P],down:_,dragging:M,first:w,elapsedTime:g}=T;if(!(!M||w||g<100)&&_&&a.current){r();const E=(y-i.left)/window.innerWidth*i.width,A=(P-i.top)/window.innerHeight*i.height,B=new N(E/i.width*2-1,-A/i.height*2+1,0).unproject(l).multiply(new N(1,1,0)).clone();t.fx=B.x,t.fy=B.y}});$e(()=>{a.current&&a.current.position.set(t.x||0,t.y||0,0)});const u=Yn[(k=t==null?void 0:t.children)==null?void 0:k.length]||"red",h=T=>{T.stopPropagation(),t.type!=="Thing"&&o()},f=Le(t.type||"",ee),x=()=>{d(!0)},m=()=>{d(!1)};return n.jsxs("mesh",{ref:a,onClick:h,...v(),onPointerOut:m,onPointerOver:x,position:new N(t.x,t.y,0),children:[n.jsx(Fn,{args:[ee,30,20],children:n.jsx("meshStandardMaterial",{attach:"material",color:u})}),n.jsx(Rt,{...Do,clipRect:[-ee,-ee,ee,ee],color:"#000",fontSize:2,maxWidth:ee*2,textAlign:"left",children:f}),c&&n.jsx(Hn,{position:[0,5,0],zIndexRange:[100,0],children:n.jsx(Gn,{children:t.type})})]})});Vt.displayName="Node";const Zn=({simulation:t,setSelectedSchemaId:o,selectedId:r,setIsAddEdgeNode:e})=>{const[a]=Dt(d=>[d.schemas]),c=()=>{t&&(t.alpha(.05),t.restart())};return n.jsx(n.Fragment,{children:a.map((d,i)=>{const l=t.nodes()[i];return l?n.jsx(Vt,{isSelected:l.ref_id===r,node:l,onSimulationUpdate:c,setSelectedNode:()=>{e(!1),o(l.ref_id)}},l.ref_id):null})})},Kn=({schemasWithPositions:t,filteredLinks:o,setSelectedSchemaId:r,selectedSchemaId:e,setIsAddEdgeNode:a,onEdgeClick:c})=>{const[d,i]=b.useState(null),l=Pt(t),v=Pt(o);return b.useEffect(()=>{if(!t.length||!o.length)return;const u=structuredClone(t),h=structuredClone(o);if(d){l&&l.length!==t.length&&v&&v.length!==o.length&&(d.nodes(u).force("link",pt(h).id(x=>x.ref_id).distance(100)).force("charge",ft()).force("center",ht()).force("collide",mt(ee+5)).alpha(.5).restart(),i({...d}));return}const f=fo(u).force("link",pt(h).id(x=>x.ref_id).distance(120)).force("charge",ft().strength(-100)).force("center",ht()).force("collide",mt(ee+5));i(f)},[t,d,o,l,v]),$e(()=>{}),d?n.jsxs(n.Fragment,{children:[n.jsx(Ft,{links:o,nodes:d.nodes(),onEdgeClick:c}),n.jsx(Zn,{selectedId:e,setIsAddEdgeNode:a,setSelectedSchemaId:r,simulation:d})]}):null},Ve=new ho(0),Xn=({selectedSchemaId:t,links:o,schemasWithPositions:r,setSelectedSchemaId:e,setIsAddEdgeNode:a,onEdgeClick:c})=>n.jsxs(Bo,{camera:{zoom:1,position:[0,0,200]},id:"schema-canvas",linear:!0,orthographic:!0,children:[n.jsx("color",{args:[Ve.r,Ve.g,Ve.b],attach:"background"}),mo&&n.jsx(Fo,{position:"right-bottom"}),n.jsx(qn,{}),n.jsx(Vo,{}),n.jsx(Kn,{filteredLinks:o,onEdgeClick:c,schemasWithPositions:r,selectedSchemaId:t,setIsAddEdgeNode:a,setSelectedSchemaId:e})]}),qn=()=>{b.useEffect(()=>{const r=a=>{["Meta","Alt"].includes(a.key)&&(document.body.style.cursor="grab")},e=a=>{["Meta","Alt"].includes(a.key)&&(document.body.style.cursor="default")};return window.addEventListener("keydown",r,!1),window.addEventListener("keyup",e,!1),()=>{window.removeEventListener("keydown",r,!1),window.removeEventListener("keyup",e,!1)}},[]);const t=()=>{document.body.style.cursor="grabbing"},o=()=>{document.body.style.cursor="default"};return n.jsx(Bn,{dampingFactor:1,enableDamping:!0,enablePan:!0,enableRotate:!1,enableZoom:!0,maxZoom:20,minZoom:1,onEnd:o,onStart:t,zoomSpeed:1.5,zoomToCursor:!0})},Qn=({onCreateNew:t,onAddEdgeNode:o})=>n.jsxs(Jn,{children:[n.jsx(es,{children:"BLUEPRINT"}),n.jsxs(St,{"data-testid":"add-schema-type",onClick:t,children:[n.jsx(Ot,{children:n.jsx(xt,{})}),n.jsx(q,{children:"Add Type"})]}),n.jsxs(St,{"data-testid":"add-edge",onClick:o,children:[n.jsx(Ot,{children:n.jsx(xt,{})}),n.jsx(q,{children:"Add Edge"})]})]}),Jn=F(j).attrs({align:"flex-start",direction:"column",justify:"flex-start"})`
  flex: 1 1 auto;
  z-index: 31;
  transition: opacity 1s;
  background: ${D.BG2};
  max-height: 100vh;
  border-top-left-radius: 9px;
  border-bottom-left-radius: 9px;

  @media (max-width: 1440px) {
    max-height: 95.2vh;
  }

  @media (max-width: 1024px) {
    max-height: 74.8vh;
  }

  @media (max-width: 924px) {
    max-height: 73.1vh;
  }
`,St=F(j).attrs({align:"center",justify:"center",p:0})`
  position: relative;
  width: 64px;
  height: 58px;
  padding: 0;
  flex-direction: row;
  color: ${D.GRAY6};
  cursor: pointer;
  transition: ${({theme:t})=>t.transitions.create(["opacity","box-shadow","background-color"])};

  &:before {
    content: '';
    position: absolute;
    left: 0;
    top: 50%;
    transform: translateY(-50%);
    width: 4px; /* Initial width */
    height: 32px; /* Initial height on hover */
    background-color: transparent;
    transition: height 0.3s, width 0.3s, background-color 0.3s;
  }

  ${q} {
    display: none;
    opacity: 0;
    width: 0;
    padding: 4px 10px;
    border-radius: 4px;
    background: #000;
    box-shadow: 0px 4px 8px 0px rgba(0, 0, 0, 0.25);
    position: absolute;
    left: 90%;
    z-index: 99;
    white-space: nowrap;
    visibility: visible;
    font-size: 11px;
    font-style: normal;
    font-weight: 400;
    transition: ${({theme:t})=>t.transitions.create(["opacity","visually"])};
  }

  &:hover {
    color: ${D.white};

    &:before {
      width: 3px;
      height: 32px;
      background-color: ${D.primaryBlue};
    }

    ${q} {
      display: block;
      width: min-content;
      opacity: 1;
      visibility: visible;
    }
  }

  &:active {
    color: ${D.white};
    background: ${D.black};
    &:before {
      width: 3px;
      height: 100%;
      background-color: ${D.primaryBlue};
    }
  }

  &.root {
    border-radius: 50%;
    padding: 0;
    align-items: center;
    justify-content: center;
    border: none;
  }
`,es=F(j)`
  background: blue;
  align-items: center;
  justify-content: center;
  background: ${D.primaryBlue};
  width: 64px;
  height: 64px;
  cursor: pointer;
  font-size: 10px;
  font-weight: 600;
  color: ${D.white};
`,Ot=F(j)`
  justify-content: center;
  align-items: center;
  font-size: 24px;
`,ts={type:"",parent:""},Mt=({onSelect:t,dataTestId:o,edgeLink:r})=>{const e=Ke({mode:"onChange",defaultValues:ts}),{watch:a,setValue:c}=e,[d,i]=b.useState([]),[l,v]=b.useState(!1),u=m=>{c("parent",(m==null?void 0:m.value)||""),t(m==null?void 0:m.value)},h=m=>m.charAt(0).toUpperCase()+m.slice(1);b.useEffect(()=>{(async()=>{v(!0);try{const T=(await $t()).schemas.filter(y=>!y.is_deleted&&y.type).map(y=>(y==null?void 0:y.type)==="thing"?{label:"No Parent",value:y.type}:{label:h(y.type),value:y.type});i(T),r&&c("parent",r)}catch(k){console.warn(k)}finally{v(!1)}})()},[r,c]);const f=a("parent"),x=()=>{const m=d==null?void 0:d.find(k=>k.value===f);if(m)return m;if(r)return{label:r,value:r}};return n.jsx(Ae,{dataTestId:o,disabled:!!r,isLoading:l,onSelect:u,options:d||So,selectedValue:x()})},os=({selectedType:t,setSelectedFromNode:o,setSelectedToNode:r,edgeLinkData:e})=>n.jsxs(j,{children:[n.jsx(j,{align:"center",direction:"row",justify:"space-between",mb:35,children:n.jsx(j,{align:"center",direction:"row",children:n.jsx(ns,{children:"Add Edge"})})}),n.jsxs(j,{mb:25,children:[n.jsx(j,{mb:12,children:n.jsx(q,{children:"Source"})}),n.jsx(Mt,{dataTestId:"from_node",edgeLink:e==null?void 0:e.source,onSelect:o})]}),n.jsxs(j,{mb:10,children:[n.jsx(j,{mb:12,children:n.jsx(q,{children:"Edge Name"})}),n.jsx(j,{mb:12,children:n.jsx(_e,{id:"cy-item-name",maxLength:250,name:"type",placeholder:"Enter type name",rules:{...Me},value:t})})]}),n.jsxs(j,{mb:25,children:[n.jsx(j,{mb:12,children:n.jsx(q,{children:"Destination"})}),n.jsx(Mt,{dataTestId:"to_node",edgeLink:e==null?void 0:e.target,onSelect:r})]})]}),ns=F(q)`
  font-size: 22px;
  font-weight: 600;
`,ss=({onCancel:t,edgeLinkData:o,setGraphLoading:r})=>{var M,w,g;const e=Ke({mode:"onChange"}),{setValue:a,getValues:c}=e,[d,i]=b.useState(!1),[l,v]=b.useState(""),[u,h]=b.useState(""),[f,x]=b.useState(""),m=e.watch("type");b.useEffect(()=>{a("type",o==null?void 0:o.edgeType)},[o==null?void 0:o.edgeType,a]),b.useEffect(()=>{v(m)},[m]);const k=e.handleSubmit(async E=>{i(!0),r(!0);const A={source:u,target:f,edge_type:E.type},R={ref_id:o==null?void 0:o.refId,edge_type:E.type};try{o!=null&&o.refId?await go(R):(!f||!u)&&await bo(A)}catch(O){console.warn("API Error:",O)}finally{i(!1),r(!1),t()}}),T=(w=(M=c())==null?void 0:M.type)==null?void 0:w.trim(),y=T&&((g=o==null?void 0:o.edgeType)==null?void 0:g.trim())!==T,P=o!=null&&o.refId?d||!y:d||!f||!u||!l,_=async()=>{try{o!=null&&o.refId&&await xo(o==null?void 0:o.refId)}catch(E){console.warn("API Error:",E)}finally{t()}};return n.jsx(zt,{...e,children:n.jsxs("form",{id:"add-type-form",onSubmit:k,children:[n.jsx(os,{edgeLinkData:o,selectedType:l,setSelectedFromNode:h,setSelectedToNode:x}),n.jsxs(j,{direction:"row",justify:"space-between",mt:20,children:[(o==null?void 0:o.refId)&&n.jsx(j,{direction:"column",children:n.jsx(as,{color:"secondary",onClick:_,size:"large",style:{marginRight:20},variant:"contained",children:"Delete"})}),n.jsxs(rs,{color:"secondary",disabled:P,onClick:k,size:"large",variant:"contained",children:["Confirm",d&&n.jsxs(is,{children:[n.jsx(we,{color:D.lightGray,size:12})," "]})]})]})]})})},rs=F(ve)`
  width: 293px !important;
  margin: 0 0 10px auto !important;
`,is=F.span`
  margin-top: 2px;
`,as=F(ve)`
  && {
    color: ${D.primaryRed};
    background-color: rgba(237, 116, 116, 0.1);

    &:hover,
    &:active,
    &:focus {
      color: ${D.primaryRed};
      background-color: rgba(237, 116, 116, 0.2);
    }
  }
`,cs=({setIsAddEdgeNode:t,edgeData:o,setGraphLoading:r})=>{const e=()=>{t(!1)};return n.jsxs(j,{children:[n.jsx(j,{direction:"row",justify:"flex-end",children:n.jsx(ls,{"data-testid":"close-sidebar-sub-view",onClick:e,children:n.jsx(It,{})})}),n.jsx(ss,{edgeLinkData:o,onCancel:e,setGraphLoading:r})]})},ls=F(j)`
  font-size: 32px;
  color: ${D.white};
  cursor: pointer;
`,ds=()=>{const[t,o]=b.useState(""),[r,e]=b.useState(!1),[a,c]=b.useState(!1),[d,i]=b.useState(!1),[l,v]=b.useState({refId:"",edgeType:"",source:"",target:""}),[u,h]=b.useState(!1),[f,x,m,k]=Dt(g=>[g.schemas,g.links,g.setSchemas,g.setSchemaLinks]);b.useEffect(()=>{(async()=>{c(!0);try{const E=await gt(),A=E.schemas.filter(R=>R.ref_id&&!R.is_deleted);m(A.length>0?A:E.schemas),k(E.edges.length>0?E.edges:[]),c(!1)}catch(E){console.error("Error fetching data:",E),c(!1)}})()},[m,k]);const T=g=>{if(f.some(A=>A.ref_id===g.ref_id))m(f.map(A=>A.ref_id===g.ref_id?{...g,children:[]}:A));else{m([...f,{...g,children:[]}]);const A=f.find(R=>g.parent===R.type);k([...x,{ref_id:`new-link-${x.length}`,edge_type:"CHILD_OF",source:g.ref_id||"new",target:(A==null?void 0:A.ref_id)||"new"}])}},y=async()=>{const g=await gt();m(g.schemas.filter(E=>E.ref_id&&!E.is_deleted&&E.ref_id)),k(g.edges)},P=g=>{m(f.filter(E=>E.type!==g))},_=f.map(g=>({...g,children:f.filter(E=>E.parent===g.type).map(E=>E.ref_id||"")})),M=x.filter(g=>_.some(E=>E.ref_id===g.source)&&_.some(E=>E.ref_id===g.target)),w=f.find(g=>g.ref_id===t)||null;return a?n.jsx(j,{align:"center",basis:"100%",grow:1,justify:"center",shrink:1,children:n.jsx(we,{color:D.white})}):n.jsx(n.Fragment,{children:n.jsxs(j,{align:"stretch",direction:"row",grow:1,children:[n.jsx(j,{ml:-20,my:-20,children:n.jsx(Qn,{onAddEdgeNode:()=>{i(!0),e(!1),o("")},onCreateNew:()=>{i(!1),e(!0),o("")}})}),n.jsx(j,{children:w||r?n.jsx(kt,{children:n.jsx(At,{children:n.jsx(kn,{graphLoading:u,onDelete:P,onSchemaCreate:T,onSchemaUpdate:y,selectedSchema:w,setGraphLoading:h,setIsCreateNew:e,setSelectedSchemaId:o})})}):null}),n.jsx(j,{children:d?n.jsx(kt,{children:n.jsx(At,{children:n.jsx(cs,{edgeData:l,setGraphLoading:h,setIsAddEdgeNode:i})})}):null}),n.jsx(us,{direction:"row",grow:1,children:n.jsx(ps,{children:u?n.jsx(j,{align:"center",basis:"100%",grow:1,justify:"center",shrink:1,children:n.jsx(we,{color:D.white})}):n.jsx(Xn,{links:M,onEdgeClick:(g,E,A,R)=>{v({refId:g,edgeType:E,source:A,target:R}),i(!0),e(!1),o("")},schemasWithPositions:_,selectedSchemaId:t,setIsAddEdgeNode:i,setSelectedSchemaId:o})})})]})})},us=F(j)`
  flex: 1 1 auto;
  justify-content: center;
  position: relative;
  overflow: hidden;
  max-height: calc(100vh - 20px);

  @media (max-width: 1440px) {
    max-height: calc(95vh - 20px);
  }

  @media (max-width: 1024px) {
    max-height: calc(70vh - 20px);
  }

  @media (max-width: 924px) {
    max-height: calc(70vh - 20px);
  }
`,kt=F(j)`
  width: 100%;
  max-width: 400px;
  background: ${D.BG1};
  border-top-right-radius: 16px;
  border-bottom-right-radius: 16px;
  flex-grow: 1;
  flex-shrink: 1;
  min-width: 300px;
  overflow: hidden;
  max-height: calc(100vh - 20px);

  @media (max-width: 1440px) {
    max-height: calc(95vh - 20px);
  }

  @media (max-width: 1024px) {
    max-height: calc(70vh - 20px);
  }

  @media (max-width: 924px) {
    max-height: calc(70vh - 20px);
  }
`,At=F.div`
  height: 100%;
  overflow-y: auto;
  padding: 16px;
`,ps=F(j)`
  flex: 1 1 100%;
`,fs=()=>{const{close:t}=Nt("blueprintGraph"),o=()=>{t()};return n.jsx(yo,{background:"black",id:"blueprintGraph",kind:"full",onClose:o,preventOutsideClose:!0,children:n.jsx(ds,{})})},Bs=b.memo(fs);export{Bs as BlueprintModal};
