import{g as Me,a as $e,s as ee,_,a8 as It,r as j,b as De,j as s,d as Re,c as J,e as Ae,u as ht,aL as zt,b7 as xe,b8 as Le,a6 as tt,b9 as Bt,ba as Ft,$ as Vt,f as Y,F as O,h as I,D as mt,b1 as Yt,T as q,B as gt,aZ as Te,W as Oe,b2 as Ut,bb as Gt,bc as Wt,bd as Ht,V as M,be as ne,bf as se,ao as ot,bg as me,bh as ge,bi as nt,bj as V,bk as Zt,aq as Kt,bl as st,bm as rt,bn as at,bo as it,bp as Xt,al as qt,Q as Qt,bq as Jt}from"./index-f14c52f6.js";import{B as eo}from"./index-454a2500.js";import{q as to,r as oo,i as no,C as Ne,I as so,B as _e,c as ro,b as ao,F as io,s as co}from"./react-toastify.esm-7be85797.js";import{e as lo,A as bt}from"./index-bbeba3d4.js";import{T as xt}from"./index-f98e65fe.js";import{c as ct,d as uo}from"./index-0e0d6027.js";import{D as po,P as fo}from"./PlusIcon-e5cf6b64.js";import{p as ho,c as mo}from"./index-30d16895.js";import{u as go}from"./Popover-36f2c011.js";import{u as bo}from"./index-58db855b.js";import{L as xo,m as yo,u as Z,b as ye,T as wo,C as jo}from"./constant-b3a110b1.js";import{f as vo,P as Eo,L as ko}from"./constants-dfb86d92.js";import{A as Po}from"./AddContentIcon-9a840c8c.js";import"./useSlotProps-6020ee6e.js";import"./Popper-c50b9a7b.js";import"./index.esm-da72a889.js";import"./InfoIcon-576dab03.js";import"./generateCategoricalChart-0daa3d74.js";import"./NoFilterResultIcon-8e2e4baa.js";import"./index-04666d84.js";import"./index-260342e6.js";import"./CheckIcon-e610e6cc.js";function Co(t){return Me("PrivateSwitchBase",t)}$e("PrivateSwitchBase",["root","checked","disabled","input","edgeStart","edgeEnd"]);const So=["autoFocus","checked","checkedIcon","className","defaultChecked","disabled","disableFocusRipple","edge","icon","id","inputProps","inputRef","name","onBlur","onChange","onFocus","readOnly","required","tabIndex","type","value"],To=t=>{const{classes:n,checked:a,disabled:e,edge:i}=t,c={root:["root",a&&"checked",e&&"disabled",i&&`edge${J(i)}`],input:["input"]};return Ae(c,Co,n)},Oo=ee(to)(({ownerState:t})=>_({padding:9,borderRadius:"50%"},t.edge==="start"&&{marginLeft:t.size==="small"?-3:-12},t.edge==="end"&&{marginRight:t.size==="small"?-3:-12})),Mo=ee("input",{shouldForwardProp:It})({cursor:"inherit",position:"absolute",opacity:0,width:"100%",height:"100%",top:0,left:0,margin:0,padding:0,zIndex:1}),$o=j.forwardRef(function(n,a){const{autoFocus:e,checked:i,checkedIcon:c,className:p,defaultChecked:r,disabled:d,disableFocusRipple:b=!1,edge:u=!1,icon:f,id:h,inputProps:v,inputRef:P,name:m,onBlur:y,onChange:C,onFocus:R,readOnly:L,required:T=!1,tabIndex:E,type:D,value:B}=n,k=De(n,So),[A,w]=bo({controlled:i,default:!!r,name:"SwitchBase",state:"checked"}),$=go(),we=F=>{R&&R(F),$&&$.onFocus&&$.onFocus(F)},te=F=>{y&&y(F),$&&$.onBlur&&$.onBlur(F)},ae=F=>{if(F.nativeEvent.defaultPrevented)return;const ie=F.target.checked;w(ie),C&&C(F,ie)};let K=d;$&&typeof K>"u"&&(K=$.disabled);const pe=D==="checkbox"||D==="radio",oe=_({},n,{checked:A,disabled:K,disableFocusRipple:b,edge:u}),U=To(oe);return s.jsxs(Oo,_({component:"span",className:Re(U.root,p),centerRipple:!0,focusRipple:!b,disabled:K,tabIndex:null,role:void 0,onFocus:we,onBlur:te,ownerState:oe,ref:a},k,{children:[s.jsx(Mo,_({autoFocus:e,checked:i,defaultChecked:r,className:U.input,disabled:K,id:pe?h:void 0,name:m,onChange:ae,readOnly:L,ref:P,required:T,ownerState:oe,tabIndex:E,type:D},D==="checkbox"&&B===void 0?{}:{value:B},v)),A?c:f]}))}),Do=$o,Ro=j.createContext(),lt=Ro;function Ao(t){return Me("MuiGrid",t)}const Lo=[0,1,2,3,4,5,6,7,8,9,10],No=["column-reverse","column","row-reverse","row"],_o=["nowrap","wrap-reverse","wrap"],de=["auto",!0,1,2,3,4,5,6,7,8,9,10,11,12],Io=$e("MuiGrid",["root","container","item","zeroMinWidth",...Lo.map(t=>`spacing-xs-${t}`),...No.map(t=>`direction-xs-${t}`),..._o.map(t=>`wrap-xs-${t}`),...de.map(t=>`grid-xs-${t}`),...de.map(t=>`grid-sm-${t}`),...de.map(t=>`grid-md-${t}`),...de.map(t=>`grid-lg-${t}`),...de.map(t=>`grid-xl-${t}`)]),ue=Io,zo=["className","columns","columnSpacing","component","container","direction","item","rowSpacing","spacing","wrap","zeroMinWidth"];function re(t){const n=parseFloat(t);return`${n}${String(t).replace(String(n),"")||"px"}`}function Bo({theme:t,ownerState:n}){let a;return t.breakpoints.keys.reduce((e,i)=>{let c={};if(n[i]&&(a=n[i]),!a)return e;if(a===!0)c={flexBasis:0,flexGrow:1,maxWidth:"100%"};else if(a==="auto")c={flexBasis:"auto",flexGrow:0,flexShrink:0,maxWidth:"none",width:"auto"};else{const p=xe({values:n.columns,breakpoints:t.breakpoints.values}),r=typeof p=="object"?p[i]:p;if(r==null)return e;const d=`${Math.round(a/r*1e8)/1e6}%`;let b={};if(n.container&&n.item&&n.columnSpacing!==0){const u=t.spacing(n.columnSpacing);if(u!=="0px"){const f=`calc(${d} + ${re(u)})`;b={flexBasis:f,maxWidth:f}}}c=_({flexBasis:d,flexGrow:0,maxWidth:d},b)}return t.breakpoints.values[i]===0?Object.assign(e,c):e[t.breakpoints.up(i)]=c,e},{})}function Fo({theme:t,ownerState:n}){const a=xe({values:n.direction,breakpoints:t.breakpoints.values});return Le({theme:t},a,e=>{const i={flexDirection:e};return e.indexOf("column")===0&&(i[`& > .${ue.item}`]={maxWidth:"none"}),i})}function yt({breakpoints:t,values:n}){let a="";Object.keys(n).forEach(i=>{a===""&&n[i]!==0&&(a=i)});const e=Object.keys(t).sort((i,c)=>t[i]-t[c]);return e.slice(0,e.indexOf(a))}function Vo({theme:t,ownerState:n}){const{container:a,rowSpacing:e}=n;let i={};if(a&&e!==0){const c=xe({values:e,breakpoints:t.breakpoints.values});let p;typeof c=="object"&&(p=yt({breakpoints:t.breakpoints.values,values:c})),i=Le({theme:t},c,(r,d)=>{var b;const u=t.spacing(r);return u!=="0px"?{marginTop:`-${re(u)}`,[`& > .${ue.item}`]:{paddingTop:re(u)}}:(b=p)!=null&&b.includes(d)?{}:{marginTop:0,[`& > .${ue.item}`]:{paddingTop:0}}})}return i}function Yo({theme:t,ownerState:n}){const{container:a,columnSpacing:e}=n;let i={};if(a&&e!==0){const c=xe({values:e,breakpoints:t.breakpoints.values});let p;typeof c=="object"&&(p=yt({breakpoints:t.breakpoints.values,values:c})),i=Le({theme:t},c,(r,d)=>{var b;const u=t.spacing(r);return u!=="0px"?{width:`calc(100% + ${re(u)})`,marginLeft:`-${re(u)}`,[`& > .${ue.item}`]:{paddingLeft:re(u)}}:(b=p)!=null&&b.includes(d)?{}:{width:"100%",marginLeft:0,[`& > .${ue.item}`]:{paddingLeft:0}}})}return i}function Uo(t,n,a={}){if(!t||t<=0)return[];if(typeof t=="string"&&!Number.isNaN(Number(t))||typeof t=="number")return[a[`spacing-xs-${String(t)}`]];const e=[];return n.forEach(i=>{const c=t[i];Number(c)>0&&e.push(a[`spacing-${i}-${String(c)}`])}),e}const Go=ee("div",{name:"MuiGrid",slot:"Root",overridesResolver:(t,n)=>{const{ownerState:a}=t,{container:e,direction:i,item:c,spacing:p,wrap:r,zeroMinWidth:d,breakpoints:b}=a;let u=[];e&&(u=Uo(p,b,n));const f=[];return b.forEach(h=>{const v=a[h];v&&f.push(n[`grid-${h}-${String(v)}`])}),[n.root,e&&n.container,c&&n.item,d&&n.zeroMinWidth,...u,i!=="row"&&n[`direction-xs-${String(i)}`],r!=="wrap"&&n[`wrap-xs-${String(r)}`],...f]}})(({ownerState:t})=>_({boxSizing:"border-box"},t.container&&{display:"flex",flexWrap:"wrap",width:"100%"},t.item&&{margin:0},t.zeroMinWidth&&{minWidth:0},t.wrap!=="wrap"&&{flexWrap:t.wrap}),Fo,Vo,Yo,Bo);function Wo(t,n){if(!t||t<=0)return[];if(typeof t=="string"&&!Number.isNaN(Number(t))||typeof t=="number")return[`spacing-xs-${String(t)}`];const a=[];return n.forEach(e=>{const i=t[e];if(Number(i)>0){const c=`spacing-${e}-${String(i)}`;a.push(c)}}),a}const Ho=t=>{const{classes:n,container:a,direction:e,item:i,spacing:c,wrap:p,zeroMinWidth:r,breakpoints:d}=t;let b=[];a&&(b=Wo(c,d));const u=[];d.forEach(h=>{const v=t[h];v&&u.push(`grid-${h}-${String(v)}`)});const f={root:["root",a&&"container",i&&"item",r&&"zeroMinWidth",...b,e!=="row"&&`direction-xs-${String(e)}`,p!=="wrap"&&`wrap-xs-${String(p)}`,...u]};return Ae(f,Ao,n)},Zo=j.forwardRef(function(n,a){const e=ht({props:n,name:"MuiGrid"}),{breakpoints:i}=zt(),c=lo(e),{className:p,columns:r,columnSpacing:d,component:b="div",container:u=!1,direction:f="row",item:h=!1,rowSpacing:v,spacing:P=0,wrap:m="wrap",zeroMinWidth:y=!1}=c,C=De(c,zo),R=v||P,L=d||P,T=j.useContext(lt),E=u?r||12:T,D={},B=_({},C);i.keys.forEach(w=>{C[w]!=null&&(D[w]=C[w],delete B[w])});const k=_({},c,{columns:E,container:u,direction:f,item:h,rowSpacing:R,columnSpacing:L,wrap:m,zeroMinWidth:y,spacing:P},D,{breakpoints:i.keys}),A=Ho(k);return s.jsx(lt.Provider,{value:E,children:s.jsx(Go,_({ownerState:k,className:Re(A.root,p),as:b,ref:a},B))})}),Q=Zo;function Ko(t){return Me("MuiSwitch",t)}const Xo=$e("MuiSwitch",["root","edgeStart","edgeEnd","switchBase","colorPrimary","colorSecondary","sizeSmall","sizeMedium","checked","disabled","input","thumb","track"]),z=Xo,qo=["className","color","edge","size","sx"],Qo=t=>{const{classes:n,edge:a,size:e,color:i,checked:c,disabled:p}=t,r={root:["root",a&&`edge${J(a)}`,`size${J(e)}`],switchBase:["switchBase",`color${J(i)}`,c&&"checked",p&&"disabled"],thumb:["thumb"],track:["track"],input:["input"]},d=Ae(r,Ko,n);return _({},n,d)},Jo=ee("span",{name:"MuiSwitch",slot:"Root",overridesResolver:(t,n)=>{const{ownerState:a}=t;return[n.root,a.edge&&n[`edge${J(a.edge)}`],n[`size${J(a.size)}`]]}})(({ownerState:t})=>_({display:"inline-flex",width:34+12*2,height:14+12*2,overflow:"hidden",padding:12,boxSizing:"border-box",position:"relative",flexShrink:0,zIndex:0,verticalAlign:"middle","@media print":{colorAdjust:"exact"}},t.edge==="start"&&{marginLeft:-8},t.edge==="end"&&{marginRight:-8},t.size==="small"&&{width:40,height:24,padding:7,[`& .${z.thumb}`]:{width:16,height:16},[`& .${z.switchBase}`]:{padding:4,[`&.${z.checked}`]:{transform:"translateX(16px)"}}})),en=ee(Do,{name:"MuiSwitch",slot:"SwitchBase",overridesResolver:(t,n)=>{const{ownerState:a}=t;return[n.switchBase,{[`& .${z.input}`]:n.input},a.color!=="default"&&n[`color${J(a.color)}`]]}})(({theme:t})=>({position:"absolute",top:0,left:0,zIndex:1,color:t.vars?t.vars.palette.Switch.defaultColor:`${t.palette.mode==="light"?t.palette.common.white:t.palette.grey[300]}`,transition:t.transitions.create(["left","transform"],{duration:t.transitions.duration.shortest}),[`&.${z.checked}`]:{transform:"translateX(20px)"},[`&.${z.disabled}`]:{color:t.vars?t.vars.palette.Switch.defaultDisabledColor:`${t.palette.mode==="light"?t.palette.grey[100]:t.palette.grey[600]}`},[`&.${z.checked} + .${z.track}`]:{opacity:.5},[`&.${z.disabled} + .${z.track}`]:{opacity:t.vars?t.vars.opacity.switchTrackDisabled:`${t.palette.mode==="light"?.12:.2}`},[`& .${z.input}`]:{left:"-100%",width:"300%"}}),({theme:t,ownerState:n})=>_({"&:hover":{backgroundColor:t.vars?`rgba(${t.vars.palette.action.activeChannel} / ${t.vars.palette.action.hoverOpacity})`:tt(t.palette.action.active,t.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}}},n.color!=="default"&&{[`&.${z.checked}`]:{color:(t.vars||t).palette[n.color].main,"&:hover":{backgroundColor:t.vars?`rgba(${t.vars.palette[n.color].mainChannel} / ${t.vars.palette.action.hoverOpacity})`:tt(t.palette[n.color].main,t.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}},[`&.${z.disabled}`]:{color:t.vars?t.vars.palette.Switch[`${n.color}DisabledColor`]:`${t.palette.mode==="light"?Bt(t.palette[n.color].main,.62):Ft(t.palette[n.color].main,.55)}`}},[`&.${z.checked} + .${z.track}`]:{backgroundColor:(t.vars||t).palette[n.color].main}})),tn=ee("span",{name:"MuiSwitch",slot:"Track",overridesResolver:(t,n)=>n.track})(({theme:t})=>({height:"100%",width:"100%",borderRadius:14/2,zIndex:-1,transition:t.transitions.create(["opacity","background-color"],{duration:t.transitions.duration.shortest}),backgroundColor:t.vars?t.vars.palette.common.onBackground:`${t.palette.mode==="light"?t.palette.common.black:t.palette.common.white}`,opacity:t.vars?t.vars.opacity.switchTrack:`${t.palette.mode==="light"?.38:.3}`})),on=ee("span",{name:"MuiSwitch",slot:"Thumb",overridesResolver:(t,n)=>n.thumb})(({theme:t})=>({boxShadow:(t.vars||t).shadows[1],backgroundColor:"currentColor",width:20,height:20,borderRadius:"50%"})),nn=j.forwardRef(function(n,a){const e=ht({props:n,name:"MuiSwitch"}),{className:i,color:c="primary",edge:p=!1,size:r="medium",sx:d}=e,b=De(e,qo),u=_({},e,{color:c,edge:p,size:r}),f=Qo(u),h=s.jsx(on,{className:f.thumb,ownerState:u});return s.jsxs(Jo,{className:Re(f.root,i),sx:d,ownerState:u,children:[s.jsx(en,_({type:"checkbox",icon:h,checkedIcon:h,ref:a,ownerState:u},b,{classes:_({},f,{root:f.switchBase})})),s.jsx(tn,{className:f.track,ownerState:u})]})}),sn=nn,rn={schemas:[],links:[]},wt=Vt(t=>({...rn,setSchemas:n=>{t({schemas:n})},setSchemaLinks:n=>{t({links:n})}})),an=/^[a-z0-9_]+$/,cn=({parentParam:t})=>{const[n,a]=j.useState(!1),[e,i]=j.useState([]),{fields:c,append:p,replace:r,remove:d}=oo({name:"attributes"}),{setValue:b,watch:u}=no();return j.useEffect(()=>{const f=async()=>{try{let h=[{required:!1,type:"string",key:""}];if(t!==uo.value.toLowerCase()){a(!0);const v=await Yt(t);h=ho(v)}r(h),i(h)}catch(h){console.warn(h)}finally{a(!1)}};e.length===0&&f()},[t,b,r,e.length]),s.jsxs(s.Fragment,{children:[n?s.jsx(O,{align:"center",children:s.jsx(Ne,{color:I.SECONDARY_BLUE,size:"30"})}):s.jsx(ln,{py:8,children:s.jsx(Q,{container:!0,spacing:2,children:c.map((f,h)=>{const v=u(`attributes[${h}].type`),P=u(`attributes[${h}].required`),m=f.isNew||!1;return s.jsxs(j.Fragment,{children:[s.jsx(Q,{item:!0,xs:5,children:s.jsx(xt,{autoComplete:"off",className:"text-input",disabled:!m,id:"cy-item-name",maxLength:50,name:`attributes.${h}.key`,placeholder:"Enter value",rules:{...mt,pattern:{message:"Please avoid special characters, spaces and uppercase",value:an}}})}),s.jsx(Q,{item:!0,xs:4,children:s.jsx(bt,{onSelect:y=>b(`attributes[${h}].type`,y==null?void 0:y.value),options:ct,selectedValue:ct.find(y=>y.value===v)})}),s.jsxs(Q,{item:!0,xs:3,children:[s.jsx(sn,{checked:P,disabled:!1,name:`attributes.${h}.required`,onChange:y=>b(`attributes[${h}].required`,y.target.checked),size:"small"}),s.jsx(so,{onClick:()=>d(h),children:s.jsx(po,{})})]})]},f.id)})})}),s.jsx(O,{align:"flex-start",py:12,children:s.jsx(_e,{onClick:()=>p({key:"",type:"string",required:!0,isNew:!0}),size:"medium",startIcon:s.jsx(fo,{}),variant:"contained",children:"Add Attribute"})})]})},ln=Y(O)`
  max-height: 260px;
  overflow: auto;
  width: calc(100% + 20px);
`,dn=({parent:t})=>{const n=t;return s.jsxs(O,{children:[s.jsx(O,{direction:"row",mb:10,children:s.jsxs(Q,{container:!0,spacing:2,children:[s.jsx(Q,{item:!0,xs:5,children:s.jsx(Ce,{style:{marginRight:180},children:"Attributes"})}),s.jsx(Q,{item:!0,xs:4,children:s.jsx(Ce,{style:{marginRight:130},children:"Type"})}),s.jsx(Q,{item:!0,xs:3,children:s.jsx(Ce,{children:"Required"})})]})}),n&&s.jsx(cn,{parentParam:n},n)]})},Ce=Y(q)`
  font-size: 15px;
  color: gray;
`,un={type:"",parent:""},pn=async(t,n=!1)=>{try{const{attributes:a,...e}=t,i={...e,attributes:mo(a)};let c;if(n?c=await Oe.put("/schema",JSON.stringify(i),{}):c=await Oe.post("/schema",JSON.stringify({...i,node_key:"name"}),{}),c.status!=="success")throw new Error("error");return c==null?void 0:c.ref_id}catch(a){let e=Te;if(a.status===400){const i=await a.json();e=i.errorCode||(i==null?void 0:i.status)||Te}else a instanceof Error&&(e=a.message);throw new Error(e)}},fn=({onSchemaCreate:t,selectedSchema:n,onDelete:a,setSelectedSchemaId:e,setIsCreateNew:i})=>{const{close:c,visible:p}=gt("addType"),r=ro({mode:"onChange",defaultValues:n?{type:n.type,parent:n.parent}:un}),{watch:d,setValue:b,reset:u}=r,[f,h]=j.useState(!1),[v,P]=j.useState(!1),[m,y]=j.useState(null);j.useEffect(()=>()=>{u()},[p,u]);const C=()=>{i(!1),e("")},R=k=>k.charAt(0).toUpperCase()+k.slice(1);j.useEffect(()=>{n||(async()=>{P(!0);try{const w=(await Ut()).schemas.filter($=>!$.is_deleted&&$.type).map($=>($==null?void 0:$.type)==="thing"?{label:"No Parent",value:$.type}:{label:R($.type),value:$.type});y(w)}catch(A){console.warn(A)}finally{P(!1)}})()},[n]);const L=d("parent"),T=()=>{c()},E=async()=>{if(n!=null&&n.type)try{await Oe.delete(`/schema/${n.ref_id}`),a(n.type),c()}catch(k){console.warn(k)}finally{i(!1)}},D=r.handleSubmit(async k=>{h(!1);try{const A=await pn({...k,...n?{ref_id:n==null?void 0:n.ref_id}:{}},!!n);t({type:k.type,parent:L||"",ref_id:(n==null?void 0:n.ref_id)||A||"new"}),T()}catch(A){if((A==null?void 0:A.status)===400){const w=await A.json();w.errorCode||w!=null&&w.status||Te}else A instanceof Error&&A.message}finally{h(!1),i(!1)}}),B=()=>m==null?void 0:m.find(k=>k.value===L);return s.jsxs(O,{children:[s.jsx(O,{direction:"row",justify:"flex-end",children:s.jsx(mn,{"data-testid":"close-sidebar-sub-view",onClick:C,children:s.jsx(ao,{})})}),s.jsx(O,{children:s.jsx(io,{...r,children:s.jsxs("form",{id:"add-type-form",onSubmit:D,children:[s.jsx(O,{children:n?s.jsxs(s.Fragment,{children:[n.parent?s.jsx(O,{mb:12,children:s.jsxs(q,{kind:"headingBold",children:["Parent: ",n.parent]})}):null,s.jsx(O,{mb:12,children:s.jsxs(q,{kind:"headingBold",children:["Type: ",n.type]})})]}):s.jsxs(s.Fragment,{children:[s.jsxs(O,{mb:12,children:[s.jsx(O,{mb:12,children:s.jsx(q,{children:"Select Parent"})}),s.jsx(bt,{isLoading:v,onSelect:k=>b("parent",(k==null?void 0:k.value)||""),options:m,selectedValue:B()})]}),s.jsxs(O,{children:[s.jsx(O,{mb:12,children:s.jsx(q,{children:"Type name"})}),s.jsx(O,{mb:12,children:s.jsx(xt,{id:"cy-item-name",maxLength:250,name:"type",placeholder:"Enter type name",rules:{...mt},value:L})})]})]})}),s.jsx(dn,{parent:n?n.type:L}),s.jsxs(O,{direction:"row",justify:"space-between",mt:20,children:[n?s.jsx(hn,{color:"secondary",onClick:E,size:"large",style:{marginRight:20},variant:"contained",children:"Delete"}):null,s.jsx(_e,{color:"secondary",disabled:f,onClick:D,size:"large",startIcon:f?s.jsx(Ne,{color:I.white,size:24}):null,variant:"contained",children:"Save"})]})]})})})]})},hn=Y(_e)`
  && {
    color: ${I.primaryRed};
    background-color: rgba(237, 116, 116, 0.1);

    &:hover,
    &:active,
    &:focus {
      color: ${I.primaryRed};
      background-color: rgba(237, 116, 116, 0.2);
    }
  }
`,mn=Y(O)`
  font-size: 32px;
  color: ${I.white};
  cursor: pointer;
`;var gn=Object.defineProperty,bn=(t,n,a)=>n in t?gn(t,n,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[n]=a,g=(t,n,a)=>(bn(t,typeof n!="symbol"?n+"":n,a),a);const be=new Gt,dt=new Wt,xn=Math.cos(70*(Math.PI/180)),ut=(t,n)=>(t%n+n)%n;let yn=class extends Ht{constructor(n,a){super(),g(this,"object"),g(this,"domElement"),g(this,"enabled",!0),g(this,"target",new M),g(this,"minDistance",0),g(this,"maxDistance",1/0),g(this,"minZoom",0),g(this,"maxZoom",1/0),g(this,"minPolarAngle",0),g(this,"maxPolarAngle",Math.PI),g(this,"minAzimuthAngle",-1/0),g(this,"maxAzimuthAngle",1/0),g(this,"enableDamping",!1),g(this,"dampingFactor",.05),g(this,"enableZoom",!0),g(this,"zoomSpeed",1),g(this,"enableRotate",!0),g(this,"rotateSpeed",1),g(this,"enablePan",!0),g(this,"panSpeed",1),g(this,"screenSpacePanning",!0),g(this,"keyPanSpeed",7),g(this,"zoomToCursor",!1),g(this,"autoRotate",!1),g(this,"autoRotateSpeed",2),g(this,"reverseOrbit",!1),g(this,"reverseHorizontalOrbit",!1),g(this,"reverseVerticalOrbit",!1),g(this,"keys",{LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"}),g(this,"mouseButtons",{LEFT:ne.ROTATE,MIDDLE:ne.DOLLY,RIGHT:ne.PAN}),g(this,"touches",{ONE:se.ROTATE,TWO:se.DOLLY_PAN}),g(this,"target0"),g(this,"position0"),g(this,"zoom0"),g(this,"_domElementKeyEvents",null),g(this,"getPolarAngle"),g(this,"getAzimuthalAngle"),g(this,"setPolarAngle"),g(this,"setAzimuthalAngle"),g(this,"getDistance"),g(this,"listenToKeyEvents"),g(this,"stopListenToKeyEvents"),g(this,"saveState"),g(this,"reset"),g(this,"update"),g(this,"connect"),g(this,"dispose"),this.object=n,this.domElement=a,this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=()=>u.phi,this.getAzimuthalAngle=()=>u.theta,this.setPolarAngle=o=>{let l=ut(o,2*Math.PI),x=u.phi;x<0&&(x+=2*Math.PI),l<0&&(l+=2*Math.PI);let S=Math.abs(l-x);2*Math.PI-S<S&&(l<x?l+=2*Math.PI:x+=2*Math.PI),f.phi=l-x,e.update()},this.setAzimuthalAngle=o=>{let l=ut(o,2*Math.PI),x=u.theta;x<0&&(x+=2*Math.PI),l<0&&(l+=2*Math.PI);let S=Math.abs(l-x);2*Math.PI-S<S&&(l<x?l+=2*Math.PI:x+=2*Math.PI),f.theta=l-x,e.update()},this.getDistance=()=>e.object.position.distanceTo(e.target),this.listenToKeyEvents=o=>{o.addEventListener("keydown",ke),this._domElementKeyEvents=o},this.stopListenToKeyEvents=()=>{this._domElementKeyEvents.removeEventListener("keydown",ke),this._domElementKeyEvents=null},this.saveState=()=>{e.target0.copy(e.target),e.position0.copy(e.object.position),e.zoom0=e.object.zoom},this.reset=()=>{e.target.copy(e.target0),e.object.position.copy(e.position0),e.object.zoom=e.zoom0,e.object.updateProjectionMatrix(),e.dispatchEvent(i),e.update(),d=r.NONE},this.update=(()=>{const o=new M,l=new M(0,1,0),x=new ot().setFromUnitVectors(n.up,l),S=x.clone().invert(),N=new M,G=new ot,X=2*Math.PI;return function(){const et=e.object.position;x.setFromUnitVectors(n.up,l),S.copy(x).invert(),o.copy(et).sub(e.target),o.applyQuaternion(x),u.setFromVector3(o),e.autoRotate&&d===r.NONE&&ae(we()),e.enableDamping?(u.theta+=f.theta*e.dampingFactor,u.phi+=f.phi*e.dampingFactor):(u.theta+=f.theta,u.phi+=f.phi);let W=e.minAzimuthAngle,H=e.maxAzimuthAngle;isFinite(W)&&isFinite(H)&&(W<-Math.PI?W+=X:W>Math.PI&&(W-=X),H<-Math.PI?H+=X:H>Math.PI&&(H-=X),W<=H?u.theta=Math.max(W,Math.min(H,u.theta)):u.theta=u.theta>(W+H)/2?Math.max(W,u.theta):Math.min(H,u.theta)),u.phi=Math.max(e.minPolarAngle,Math.min(e.maxPolarAngle,u.phi)),u.makeSafe(),e.enableDamping===!0?e.target.addScaledVector(v,e.dampingFactor):e.target.add(v),e.zoomToCursor&&A||e.object.isOrthographicCamera?u.radius=je(u.radius):u.radius=je(u.radius*h),o.setFromSpherical(u),o.applyQuaternion(S),et.copy(e.target).add(o),e.object.matrixAutoUpdate||e.object.updateMatrix(),e.object.lookAt(e.target),e.enableDamping===!0?(f.theta*=1-e.dampingFactor,f.phi*=1-e.dampingFactor,v.multiplyScalar(1-e.dampingFactor)):(f.set(0,0,0),v.set(0,0,0));let fe=!1;if(e.zoomToCursor&&A){let ce=null;if(e.object instanceof me&&e.object.isPerspectiveCamera){const le=o.length();ce=je(le*h);const he=le-ce;e.object.position.addScaledVector(B,he),e.object.updateMatrixWorld()}else if(e.object.isOrthographicCamera){const le=new M(k.x,k.y,0);le.unproject(e.object),e.object.zoom=Math.max(e.minZoom,Math.min(e.maxZoom,e.object.zoom/h)),e.object.updateProjectionMatrix(),fe=!0;const he=new M(k.x,k.y,0);he.unproject(e.object),e.object.position.sub(he).add(le),e.object.updateMatrixWorld(),ce=o.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),e.zoomToCursor=!1;ce!==null&&(e.screenSpacePanning?e.target.set(0,0,-1).transformDirection(e.object.matrix).multiplyScalar(ce).add(e.object.position):(be.origin.copy(e.object.position),be.direction.set(0,0,-1).transformDirection(e.object.matrix),Math.abs(e.object.up.dot(be.direction))<xn?n.lookAt(e.target):(dt.setFromNormalAndCoplanarPoint(e.object.up,e.target),be.intersectPlane(dt,e.target))))}else e.object instanceof ge&&e.object.isOrthographicCamera&&(e.object.zoom=Math.max(e.minZoom,Math.min(e.maxZoom,e.object.zoom/h)),e.object.updateProjectionMatrix(),fe=!0);return h=1,A=!1,fe||N.distanceToSquared(e.object.position)>b||8*(1-G.dot(e.object.quaternion))>b?(e.dispatchEvent(i),N.copy(e.object.position),G.copy(e.object.quaternion),fe=!1,!0):!1}})(),this.connect=o=>{o===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),e.domElement=o,e.domElement.style.touchAction="none",e.domElement.addEventListener("contextmenu",qe),e.domElement.addEventListener("pointerdown",Ze),e.domElement.addEventListener("pointercancel",Ke),e.domElement.addEventListener("wheel",Xe)},this.dispose=()=>{var o,l,x,S,N,G;(o=e.domElement)==null||o.removeEventListener("contextmenu",qe),(l=e.domElement)==null||l.removeEventListener("pointerdown",Ze),(x=e.domElement)==null||x.removeEventListener("pointercancel",Ke),(S=e.domElement)==null||S.removeEventListener("wheel",Xe),(N=e.domElement)==null||N.ownerDocument.removeEventListener("pointermove",ve),(G=e.domElement)==null||G.ownerDocument.removeEventListener("pointerup",Ee),e._domElementKeyEvents!==null&&e._domElementKeyEvents.removeEventListener("keydown",ke)};const e=this,i={type:"change"},c={type:"start"},p={type:"end"},r={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let d=r.NONE;const b=1e-6,u=new nt,f=new nt;let h=1;const v=new M,P=new V,m=new V,y=new V,C=new V,R=new V,L=new V,T=new V,E=new V,D=new V,B=new M,k=new V;let A=!1;const w=[],$={};function we(){return 2*Math.PI/60/60*e.autoRotateSpeed}function te(){return Math.pow(.95,e.zoomSpeed)}function ae(o){e.reverseOrbit||e.reverseHorizontalOrbit?f.theta+=o:f.theta-=o}function K(o){e.reverseOrbit||e.reverseVerticalOrbit?f.phi+=o:f.phi-=o}const pe=(()=>{const o=new M;return function(x,S){o.setFromMatrixColumn(S,0),o.multiplyScalar(-x),v.add(o)}})(),oe=(()=>{const o=new M;return function(x,S){e.screenSpacePanning===!0?o.setFromMatrixColumn(S,1):(o.setFromMatrixColumn(S,0),o.crossVectors(e.object.up,o)),o.multiplyScalar(x),v.add(o)}})(),U=(()=>{const o=new M;return function(x,S){const N=e.domElement;if(N&&e.object instanceof me&&e.object.isPerspectiveCamera){const G=e.object.position;o.copy(G).sub(e.target);let X=o.length();X*=Math.tan(e.object.fov/2*Math.PI/180),pe(2*x*X/N.clientHeight,e.object.matrix),oe(2*S*X/N.clientHeight,e.object.matrix)}else N&&e.object instanceof ge&&e.object.isOrthographicCamera?(pe(x*(e.object.right-e.object.left)/e.object.zoom/N.clientWidth,e.object.matrix),oe(S*(e.object.top-e.object.bottom)/e.object.zoom/N.clientHeight,e.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),e.enablePan=!1)}})();function F(o){e.object instanceof me&&e.object.isPerspectiveCamera||e.object instanceof ge&&e.object.isOrthographicCamera?h/=o:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),e.enableZoom=!1)}function ie(o){e.object instanceof me&&e.object.isPerspectiveCamera||e.object instanceof ge&&e.object.isOrthographicCamera?h*=o:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),e.enableZoom=!1)}function ze(o){if(!e.zoomToCursor||!e.domElement)return;A=!0;const l=e.domElement.getBoundingClientRect(),x=o.clientX-l.left,S=o.clientY-l.top,N=l.width,G=l.height;k.x=x/N*2-1,k.y=-(S/G)*2+1,B.set(k.x,k.y,1).unproject(e.object).sub(e.object.position).normalize()}function je(o){return Math.max(e.minDistance,Math.min(e.maxDistance,o))}function Be(o){P.set(o.clientX,o.clientY)}function Et(o){ze(o),T.set(o.clientX,o.clientY)}function Fe(o){C.set(o.clientX,o.clientY)}function kt(o){m.set(o.clientX,o.clientY),y.subVectors(m,P).multiplyScalar(e.rotateSpeed);const l=e.domElement;l&&(ae(2*Math.PI*y.x/l.clientHeight),K(2*Math.PI*y.y/l.clientHeight)),P.copy(m),e.update()}function Pt(o){E.set(o.clientX,o.clientY),D.subVectors(E,T),D.y>0?F(te()):D.y<0&&ie(te()),T.copy(E),e.update()}function Ct(o){R.set(o.clientX,o.clientY),L.subVectors(R,C).multiplyScalar(e.panSpeed),U(L.x,L.y),C.copy(R),e.update()}function St(o){ze(o),o.deltaY<0?ie(te()):o.deltaY>0&&F(te()),e.update()}function Tt(o){let l=!1;switch(o.code){case e.keys.UP:U(0,e.keyPanSpeed),l=!0;break;case e.keys.BOTTOM:U(0,-e.keyPanSpeed),l=!0;break;case e.keys.LEFT:U(e.keyPanSpeed,0),l=!0;break;case e.keys.RIGHT:U(-e.keyPanSpeed,0),l=!0;break}l&&(o.preventDefault(),e.update())}function Ve(){if(w.length==1)P.set(w[0].pageX,w[0].pageY);else{const o=.5*(w[0].pageX+w[1].pageX),l=.5*(w[0].pageY+w[1].pageY);P.set(o,l)}}function Ye(){if(w.length==1)C.set(w[0].pageX,w[0].pageY);else{const o=.5*(w[0].pageX+w[1].pageX),l=.5*(w[0].pageY+w[1].pageY);C.set(o,l)}}function Ue(){const o=w[0].pageX-w[1].pageX,l=w[0].pageY-w[1].pageY,x=Math.sqrt(o*o+l*l);T.set(0,x)}function Ot(){e.enableZoom&&Ue(),e.enablePan&&Ye()}function Mt(){e.enableZoom&&Ue(),e.enableRotate&&Ve()}function Ge(o){if(w.length==1)m.set(o.pageX,o.pageY);else{const x=Pe(o),S=.5*(o.pageX+x.x),N=.5*(o.pageY+x.y);m.set(S,N)}y.subVectors(m,P).multiplyScalar(e.rotateSpeed);const l=e.domElement;l&&(ae(2*Math.PI*y.x/l.clientHeight),K(2*Math.PI*y.y/l.clientHeight)),P.copy(m)}function We(o){if(w.length==1)R.set(o.pageX,o.pageY);else{const l=Pe(o),x=.5*(o.pageX+l.x),S=.5*(o.pageY+l.y);R.set(x,S)}L.subVectors(R,C).multiplyScalar(e.panSpeed),U(L.x,L.y),C.copy(R)}function He(o){const l=Pe(o),x=o.pageX-l.x,S=o.pageY-l.y,N=Math.sqrt(x*x+S*S);E.set(0,N),D.set(0,Math.pow(E.y/T.y,e.zoomSpeed)),F(D.y),T.copy(E)}function $t(o){e.enableZoom&&He(o),e.enablePan&&We(o)}function Dt(o){e.enableZoom&&He(o),e.enableRotate&&Ge(o)}function Ze(o){var l,x;e.enabled!==!1&&(w.length===0&&((l=e.domElement)==null||l.ownerDocument.addEventListener("pointermove",ve),(x=e.domElement)==null||x.ownerDocument.addEventListener("pointerup",Ee)),_t(o),o.pointerType==="touch"?Lt(o):Rt(o))}function ve(o){e.enabled!==!1&&(o.pointerType==="touch"?Nt(o):At(o))}function Ee(o){var l,x,S;Qe(o),w.length===0&&((l=e.domElement)==null||l.releasePointerCapture(o.pointerId),(x=e.domElement)==null||x.ownerDocument.removeEventListener("pointermove",ve),(S=e.domElement)==null||S.ownerDocument.removeEventListener("pointerup",Ee)),e.dispatchEvent(p),d=r.NONE}function Ke(o){Qe(o)}function Rt(o){let l;switch(o.button){case 0:l=e.mouseButtons.LEFT;break;case 1:l=e.mouseButtons.MIDDLE;break;case 2:l=e.mouseButtons.RIGHT;break;default:l=-1}switch(l){case ne.DOLLY:if(e.enableZoom===!1)return;Et(o),d=r.DOLLY;break;case ne.ROTATE:if(o.ctrlKey||o.metaKey||o.shiftKey){if(e.enablePan===!1)return;Fe(o),d=r.PAN}else{if(e.enableRotate===!1)return;Be(o),d=r.ROTATE}break;case ne.PAN:if(o.ctrlKey||o.metaKey||o.shiftKey){if(e.enableRotate===!1)return;Be(o),d=r.ROTATE}else{if(e.enablePan===!1)return;Fe(o),d=r.PAN}break;default:d=r.NONE}d!==r.NONE&&e.dispatchEvent(c)}function At(o){if(e.enabled!==!1)switch(d){case r.ROTATE:if(e.enableRotate===!1)return;kt(o);break;case r.DOLLY:if(e.enableZoom===!1)return;Pt(o);break;case r.PAN:if(e.enablePan===!1)return;Ct(o);break}}function Xe(o){e.enabled===!1||e.enableZoom===!1||d!==r.NONE&&d!==r.ROTATE||(o.preventDefault(),e.dispatchEvent(c),St(o),e.dispatchEvent(p))}function ke(o){e.enabled===!1||e.enablePan===!1||Tt(o)}function Lt(o){switch(Je(o),w.length){case 1:switch(e.touches.ONE){case se.ROTATE:if(e.enableRotate===!1)return;Ve(),d=r.TOUCH_ROTATE;break;case se.PAN:if(e.enablePan===!1)return;Ye(),d=r.TOUCH_PAN;break;default:d=r.NONE}break;case 2:switch(e.touches.TWO){case se.DOLLY_PAN:if(e.enableZoom===!1&&e.enablePan===!1)return;Ot(),d=r.TOUCH_DOLLY_PAN;break;case se.DOLLY_ROTATE:if(e.enableZoom===!1&&e.enableRotate===!1)return;Mt(),d=r.TOUCH_DOLLY_ROTATE;break;default:d=r.NONE}break;default:d=r.NONE}d!==r.NONE&&e.dispatchEvent(c)}function Nt(o){switch(Je(o),d){case r.TOUCH_ROTATE:if(e.enableRotate===!1)return;Ge(o),e.update();break;case r.TOUCH_PAN:if(e.enablePan===!1)return;We(o),e.update();break;case r.TOUCH_DOLLY_PAN:if(e.enableZoom===!1&&e.enablePan===!1)return;$t(o),e.update();break;case r.TOUCH_DOLLY_ROTATE:if(e.enableZoom===!1&&e.enableRotate===!1)return;Dt(o),e.update();break;default:d=r.NONE}}function qe(o){e.enabled!==!1&&o.preventDefault()}function _t(o){w.push(o)}function Qe(o){delete $[o.pointerId];for(let l=0;l<w.length;l++)if(w[l].pointerId==o.pointerId){w.splice(l,1);return}}function Je(o){let l=$[o.pointerId];l===void 0&&(l=new V,$[o.pointerId]=l),l.set(o.pageX,o.pageY)}function Pe(o){const l=o.pointerId===w[0].pointerId?w[1]:w[0];return $[l.pointerId]}a!==void 0&&this.connect(a),this.update()}};const wn=new M,jn=j.forwardRef(function({start:n=[0,0,0],end:a=[0,0,0],mid:e,segments:i=20,...c},p){const r=j.useRef(null),[d]=j.useState(()=>new Zt(void 0,void 0,void 0)),b=j.useCallback((f,h,v,P=20)=>(f instanceof M?d.v0.copy(f):d.v0.set(...f),h instanceof M?d.v2.copy(h):d.v2.set(...h),v instanceof M?d.v1.copy(v):d.v1.copy(d.v0.clone().add(d.v2.clone().sub(d.v0)).add(wn.set(0,d.v0.y-d.v2.y,0))),d.getPoints(P)),[]);j.useLayoutEffect(()=>{r.current.setPoints=(f,h,v)=>{const P=b(f,h,v);r.current.geometry&&r.current.geometry.setPositions(P.map(m=>m.toArray()).flat())}},[]);const u=j.useMemo(()=>b(n,a,e,i),[n,a,e,i]);return j.createElement(xo,_({ref:yo([r,p]),points:u},c))}),vn=j.forwardRef(({makeDefault:t,camera:n,regress:a,domElement:e,enableDamping:i=!0,onChange:c,onStart:p,onEnd:r,...d},b)=>{const u=Z(E=>E.invalidate),f=Z(E=>E.camera),h=Z(E=>E.gl),v=Z(E=>E.events),P=Z(E=>E.setEvents),m=Z(E=>E.set),y=Z(E=>E.get),C=Z(E=>E.performance),R=n||f,L=e||v.connected||h.domElement,T=j.useMemo(()=>new yn(R),[R]);return ye(()=>{T.enabled&&T.update()},-1),j.useEffect(()=>(T.connect(L),()=>void T.dispose()),[L,a,T,u]),j.useEffect(()=>{const E=k=>{u(),a&&C.regress(),c&&c(k)},D=k=>{p&&p(k)},B=k=>{r&&r(k)};return T.addEventListener("change",E),T.addEventListener("start",D),T.addEventListener("end",B),()=>{T.removeEventListener("start",D),T.removeEventListener("end",B),T.removeEventListener("change",E)}},[c,p,r,T,u,P]),j.useEffect(()=>{if(t){const E=y().controls;return m({controls:T}),()=>m({controls:E})}},[t,T]),j.createElement("primitive",_({ref:b,object:T,enableDamping:i},d))});function En(t){const n=t+"Geometry";return j.forwardRef(({args:a,children:e,...i},c)=>j.createElement("mesh",_({ref:c},i),j.createElement(n,{attach:"geometry",args:a}),e))}const kn=En("circle"),pt=t=>{const n=j.useRef();return j.useEffect(()=>{n.current=t}),n.current},Ie=10,Pn=2,ft=2,Cn=(t,n,a)=>{const c=new M().subVectors(n,t).normalize().multiplyScalar(a);return new M().addVectors(t,c)},jt=({links:t,nodes:n})=>{const a=j.useRef(null);return ye(()=>{a.current&&n&&a.current.children.forEach((e,i)=>{var m;const c=t[i];if(!c)return;const p=n.find(y=>y.ref_id===c.source),r=n.find(y=>y.ref_id===c.target),d=new M((r==null?void 0:r.x)||0,(r==null?void 0:r.y)||0,(r==null?void 0:r.z)||0),b=new M((p==null?void 0:p.x)||0,(p==null?void 0:p.y)||0,(p==null?void 0:p.z)||0),u=Cn(b,d,Ie+ft),f=d.clone(),h=new M().lerpVectors(f,u,0),v=e.children[0],P=e.children[1];P.position.set(u.x,u.y,u.z),P.lookAt(f),P.rotateX(-Math.PI/2),(m=v.setPoints)==null||m.call(v,f,u,h)})}),s.jsx("group",{ref:a,children:t.map(e=>s.jsxs("group",{children:[s.jsx(jn,{color:"white",end:[0,0,0],lineWidth:2,start:[0,0,0]}),s.jsxs("mesh",{position:new M(0,0,0),children:[s.jsx("coneGeometry",{args:[Pn,ft,32]}),s.jsx("meshBasicMaterial",{color:"white"})]})]},e.ref_id))})};jt.displayName="Lines";const Sn=["#ff13c9","#5af0ff","#3233ff","#c2f0c2","#ff6666","#99ccff","#ffb3b3"];new Kt(2,2,2);const vt=j.memo(({node:t,setSelectedNode:n,onSimulationUpdate:a,isSelected:e})=>{var u;const i=j.useRef(null);console.log(e);const{size:c,camera:p}=Z(),r=co(f=>{const{xy:[h,v],down:P,dragging:m,first:y,elapsedTime:C}=f;if(!(!m||y||C<100)&&P&&i.current){a();const R=(h-c.left)/window.innerWidth*c.width,L=(v-c.top)/window.innerHeight*c.height,D=new M(R/c.width*2-1,-L/c.height*2+1,0).unproject(p).multiply(new M(1,1,0)).clone();t.fx=D.x,t.fy=D.y}});ye(()=>{i.current&&i.current.position.set(t.x||0,t.y||0,0)});const d=Sn[(u=t==null?void 0:t.children)==null?void 0:u.length]||"red",b=f=>{f.stopPropagation(),n()};return s.jsxs("mesh",{ref:i,onClick:b,...r(),position:new M(t.x,t.y,0),children:[s.jsx(kn,{args:[Ie,30,20],children:s.jsx("meshStandardMaterial",{attach:"material",color:d})}),s.jsx(wo,{...vo,color:"#000",fontSize:2,children:t.type})]})});vt.displayName="Node";const Tn=({simulation:t,setSelectedSchemaId:n,selectedId:a})=>{const[e]=wt(c=>[c.schemas]),i=()=>{t&&(t.alpha(.05),t.restart())};return s.jsx(s.Fragment,{children:e.map((c,p)=>{const r=t.nodes()[p];return r?s.jsx(vt,{isSelected:r.ref_id===a,node:r,onSimulationUpdate:i,setSelectedNode:()=>n(r.ref_id)},r.ref_id):null})})},On=({schemasWithPositions:t,filteredLinks:n,setSelectedSchemaId:a,selectedSchemaId:e})=>{const[i,c]=j.useState(null),p=pt(t),r=pt(n);return j.useEffect(()=>{if(!t.length||!n.length)return;const d=structuredClone(t),b=structuredClone(n);if(i){p&&p.length!==t.length&&r&&r.length!==n.length&&(i.nodes(d).force("link",st(b).id(f=>f.ref_id)).force("charge",rt()).force("center",at()).force("collide",it(Ie+1)).alpha(.5).restart(),c({...i}));return}const u=Xt(d).force("link",st(b).id(f=>f.ref_id)).force("charge",rt()).force("center",at()).force("collide",it(0));c(u)},[t,i,n,p,r]),ye(()=>{}),i?s.jsxs(s.Fragment,{children:[s.jsx(jt,{links:n,nodes:i.nodes()}),s.jsx(Tn,{selectedId:e,setSelectedSchemaId:a,simulation:i})]}):null},Se=new qt(0),Mn=({selectedSchemaId:t,links:n,schemasWithPositions:a,setSelectedSchemaId:e})=>s.jsxs(jo,{camera:{zoom:1,position:[0,0,200]},id:"schema-canvas",linear:!0,orthographic:!0,children:[s.jsx("color",{args:[Se.r,Se.g,Se.b],attach:"background"}),Qt&&s.jsx(Eo,{position:"right-bottom"}),s.jsx(vn,{enableRotate:!1,enableZoom:!0}),s.jsx(ko,{}),s.jsx(On,{filteredLinks:n,schemasWithPositions:a,selectedSchemaId:t,setSelectedSchemaId:e})]}),$n=({onCreateNew:t})=>s.jsxs(Dn,{children:[s.jsx(An,{children:"BLUEPRINT"}),s.jsxs(Rn,{"data-testid":"add-schema-type",onClick:t,children:[s.jsx(Ln,{children:s.jsx(Po,{})}),s.jsx(q,{children:"Add Item"})]})]}),Dn=Y(O).attrs({align:"flex-start",direction:"column",justify:"flex-start"})`
  flex: 1 1 64px;
  z-index: 31;
  transition: opacity 1s;
  background: ${I.BG2};
`,Rn=Y(O).attrs({align:"center",justify:"center",p:0})`
  position: relative;
  width: 64px;
  height: 58px;
  padding: 0;
  flex-direction: row;
  color: ${I.GRAY6};
  cursor: pointer;
  transition: ${({theme:t})=>t.transitions.create(["opacity","box-shadow","background-color"])};

  &:before {
    content: '';
    position: absolute;
    left: 0;
    top: 50%;
    transform: translateY(-50%);
    width: 4px; /* Initial width */
    height: 32px; /* Initial height on hover */
    background-color: transparent;
    transition: height 0.3s, width 0.3s, background-color 0.3s;
  }

  ${q} {
    display: none;
    opacity: 0;
    width: 0;
    padding: 4px 10px;
    border-radius: 4px;
    background: #000;
    box-shadow: 0px 4px 8px 0px rgba(0, 0, 0, 0.25);
    position: absolute;
    left: 90%;
    z-index: 99;
    white-space: nowrap;
    visibility: visible;
    font-size: 11px;
    font-style: normal;
    font-weight: 400;
    transition: ${({theme:t})=>t.transitions.create(["opacity","visually"])};
  }

  &:hover {
    color: ${I.white};

    &:before {
      width: 3px;
      height: 32px;
      background-color: ${I.primaryBlue};
    }

    ${q} {
      display: block;
      width: min-content;
      opacity: 1;
      visibility: visible;
    }
  }

  &:active {
    color: ${I.white};
    background: ${I.black};
    &:before {
      width: 3px;
      height: 100%;
      background-color: ${I.primaryBlue};
    }
  }

  &.root {
    border-radius: 50%;
    padding: 0;
    align-items: center;
    justify-content: center;
    border: none;
  }
`,An=Y(O)`
  background: blue;
  align-items: center;
  justify-content: center;
  background: ${I.primaryBlue};
  width: 64px;
  height: 64px;
  cursor: pointer;
  font-size: 10px;
  font-weight: 600;
  color: ${I.white};
`,Ln=Y(O)`
  justify-content: center;
  align-items: center;
  font-size: 24px;
`,Nn=()=>{const[t,n]=j.useState(""),[a,e]=j.useState(!1),[i,c]=j.useState(!1),[p,r,d,b]=wt(m=>[m.schemas,m.links,m.setSchemas,m.setSchemaLinks]);j.useEffect(()=>{(async()=>{c(!0);try{const y=await Jt();d(y.schemas.filter(C=>C.ref_id&&!C.is_deleted&&C.ref_id)),b(y.edges),c(!1)}catch(y){console.error("Error fetching data:",y),c(!1)}})()},[d,b]);const u=m=>{if(p.some(C=>C.ref_id===m.ref_id))d(p.map(C=>C.ref_id===m.ref_id?{...m,children:[]}:C));else{d([...p,{...m,children:[]}]);const C=p.find(R=>m.parent===R.type);b([...r,{ref_id:`new-link-${r.length}`,edge_type:"CHILD_OF",source:m.ref_id||"new",target:(C==null?void 0:C.ref_id)||"new"}])}},f=m=>{d(p.filter(y=>y.type!==m))},h=p.map(m=>({...m,children:p.filter(y=>y.parent===m.type).map(y=>y.ref_id||"")})),v=r.filter(m=>m.edge_type==="CHILD_OF"&&h.some(y=>y.ref_id===m.source)&&h.some(y=>y.ref_id===m.target)),P=p.find(m=>m.ref_id===t)||null;return i?s.jsx(O,{align:"center",basis:"100%",grow:1,justify:"center",shrink:1,children:s.jsx(Ne,{color:I.white})}):s.jsx(s.Fragment,{children:s.jsxs(O,{align:"stretch",direction:"row",grow:1,children:[s.jsx(O,{ml:-20,my:-20,children:s.jsx($n,{onCreateNew:()=>e(!0)})}),s.jsx(O,{children:P||a?s.jsx(In,{children:s.jsx(fn,{onDelete:f,onSchemaCreate:u,selectedSchema:P,setIsCreateNew:e,setSelectedSchemaId:n})}):null}),s.jsx(_n,{direction:"row",grow:1,children:s.jsx(zn,{children:s.jsx(Mn,{links:v,schemasWithPositions:h,selectedSchemaId:t,setSelectedSchemaId:n})})})]})})},_n=Y(O)`
  flex: 1 1 100%;
  justify-content: center;
  position: relative;
`,In=Y(O)`
  width: 400px;
  background: ${I.BG1};
  padding: 16px;
  border-top-right-radius: 16px;
  border-bottom-right-radius: 16px;
  flex-grow: 1;
`,zn=Y(O)`
  flex: 1 1 100%;
`,Bn=()=>{const{close:t}=gt("blueprintGraph"),n=()=>{t()};return s.jsx(eo,{background:"black",id:"blueprintGraph",kind:"full",onClose:n,preventOutsideClose:!0,children:s.jsx(Nn,{})})},us=j.memo(Bn);export{us as BlueprintModal};
